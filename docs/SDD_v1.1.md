# è¨˜å¸³é€š - è»Ÿé«”è¨­è¨ˆè¦æ ¼æ›¸ (SDD)

> **ç‰ˆæœ¬**ï¼š1.1  
> **å»ºç«‹æ—¥æœŸ**ï¼š2026-01-09  
> **æ›´æ–°æ—¥æœŸ**ï¼š2026-01-09  
> **å°ˆæ¡ˆä»£è™Ÿ**ï¼šQuote24 (è¨˜å¸³é€š)  
> **ç¶²å€**ï¼šhttps://quote24.cc

---

## 1. ç³»çµ±æ¦‚è¿°

### 1.1 å°ˆæ¡ˆç›®æ¨™

å»ºç«‹ä¸€å¥—å°ˆç‚ºå°ç£ä¸­å°ä¼æ¥­è¨­è¨ˆçš„é›²ç«¯è¨˜å¸³èˆ‡å ±ç¨…æ•´åˆç³»çµ±ï¼Œè®“å¹´ç‡Ÿæ”¶ 3,000 è¬ä»¥ä¸‹çš„å¾®å‹ä¼æ¥­èƒ½å¤ è‡ªä¸»å®Œæˆè¨˜å¸³ã€å ±åƒ¹ã€è²¡å‹™å ±è¡¨ç”¢å‡ºåŠç¨…å‹™ç”³å ±ï¼Œä¸å†ä¾è³´å¤–éƒ¨è¨˜å¸³å£«æˆ–æœƒè¨ˆäº‹å‹™æ‰€ã€‚

### 1.2 ç›®æ¨™å®¢ç¾¤

| ç‰¹å¾µ | æè¿° |
|------|------|
| **ä¼æ¥­è¦æ¨¡** | å¹´ç‡Ÿæ”¶ NT$3,000 è¬ä»¥ä¸‹ |
| **å“¡å·¥äººæ•¸** | 10 äººä»¥ä¸‹çš„å¾®å‹ä¼æ¥­ |
| **ç¾æ³ç—›é»** | ä½¿ç”¨ Excel è¨˜å¸³ã€æ¯æœˆèŠ± NT$2,000-5,000 è«‹è¨˜å¸³å£« |
| **æ ¸å¿ƒéœ€æ±‚** | æƒ³çœéŒ¢è‡ªå·±è™•ç†ï¼Œä½†ä¸æœƒå ±ç¨… |

### 1.3 ç”¢å“åƒ¹å€¼ä¸»å¼µ

> **ã€Œè¨˜å¸³ + å ±ç¨…ï¼Œä¸€ç«™æå®šã€**  
> ä¸åªæ˜¯è¨˜å¸³è»Ÿé«”ï¼Œæ›´æ˜¯ä½ çš„é›²ç«¯æœƒè¨ˆéƒ¨é–€

| å‚³çµ±åšæ³• | ä½¿ç”¨è¨˜å¸³é€š |
|---------|-----------|
| è¨˜å¸³å£«æœˆè²» NT$2,000-5,000 | Entry æ–¹æ¡ˆ NT$199/æœˆ |
| æœƒè¨ˆäº‹å‹™æ‰€å¹´è²» NT$60,000+ | Pro æ–¹æ¡ˆ NT$2,499/æœˆ |
| Excel è¨˜å¸³ + æ‰‹å‹•å ±ç¨… | è‡ªå‹•ç”¢å‡ºç”³å ±æª”æ¡ˆ |

### 1.4 ç³»çµ±ç¯„åœ

| æ¨¡çµ„ | åŠŸèƒ½æè¿° | æ–¹æ¡ˆé™åˆ¶ |
|------|---------|---------|
| **éŠ·å”®å ±åƒ¹** | å ±åƒ¹å–® â†’ è¨‚å–® â†’ å‡ºè²¨å–® â†’ ç™¼ç¥¨ å®Œæ•´æµç¨‹ | å…¨æ–¹æ¡ˆ |
| **å®¢æˆ¶ç®¡ç†** | å®¢æˆ¶/å» å•†è³‡æ–™ç¶­è­·ã€è¯çµ¡äººç®¡ç† | å…¨æ–¹æ¡ˆ |
| **è²¡å‹™å ±è¡¨** | è³‡ç”¢è² å‚µè¡¨ã€æç›Šè¡¨ã€ç¾é‡‘æµé‡è¡¨ã€æ‡‰æ”¶æ‡‰ä»˜æ˜ç´° | å…¨æ–¹æ¡ˆ |
| **é€²éŠ·å­˜** | åº«å­˜ç®¡ç†ã€é€²éŠ·å­˜å ±è¡¨ | å…¨æ–¹æ¡ˆ |
| **é€šçŸ¥æé†’** | App æ¨æ’­ã€ç³»çµ±é€šçŸ¥ã€Email é€šçŸ¥ | å…¨æ–¹æ¡ˆ |
| **é›»å­ç™¼ç¥¨** | Payuni ä¸²æ¥ï¼ŒB2B/B2C ç™¼ç¥¨é–‹ç«‹ | Standard+ |
| **ç‡Ÿæ¥­ç¨…ç”³å ±** | 401 ç”³å ± Media æª” + PDF é è¦½ | Standard+ |
| **ç‡Ÿæ‰€ç¨…è¨ˆç®—** | æ“´å¤§æ›¸å¯©è©¦ç®— + ç”³å ±æ›¸è¡¨ | Pro |

---

## 2. å•†æ¥­æ¨¡å¼èˆ‡å®šåƒ¹

### 2.1 è¨‚é–±æ–¹æ¡ˆ

| æ–¹æ¡ˆ | æœˆè²» | ç›®æ¨™ç”¨æˆ¶ | æ ¸å¿ƒåƒ¹å€¼ |
|------|-----:|---------|---------|
| **Entry** | NT$199 | å€‹äººå·¥ä½œå®¤ã€å‰›å‰µæ¥­ | è¼•é‡è¨˜å¸³å…¥é–€ |
| **Standard** | NT$899 | å°å‹å…¬å¸ã€æœ‰å ±ç¨…éœ€æ±‚ | å–ä»£è¨˜å¸³å£« |
| **Pro** | NT$2,499 | æˆé•·å‹ä¼æ¥­ã€å®Œæ•´éœ€æ±‚ | å–ä»£æœƒè¨ˆäº‹å‹™æ‰€ |

### 2.2 åŠŸèƒ½çŸ©é™£

| åŠŸèƒ½ | Entry | Standard | Pro |
|------|:-----:|:--------:|:---:|
| ğŸ“ éŠ·å”®å ±åƒ¹ç³»çµ±ï¼ˆç„¡é™ï¼‰ | âœ… | âœ… | âœ… |
| ğŸ“Š è²¡å‹™å ±è¡¨ | âœ… | âœ… | âœ… |
| ğŸ‘¥ å®¢æˆ¶/å» å•†è³‡æ–™ï¼ˆç„¡é™ï¼‰ | âœ… | âœ… | âœ… |
| ğŸ“¦ é€²éŠ·å­˜ç®¡ç† | âœ… | âœ… | âœ… |
| ğŸ“ æª”æ¡ˆé™„ä»¶ä¸Šå‚³ | âœ… | âœ… | âœ… |
| ğŸ”„ è³‡æ–™åŒ¯å…¥åŒ¯å‡º | âœ… | âœ… | âœ… |
| ğŸ”” æ”¶æ¬¾æé†’ï¼ˆApp æ¨æ’­ï¼‰ | âœ… | âœ… | âœ… |
| ğŸ“§ Email é€šçŸ¥ | âœ… | âœ… | âœ… |
| ğŸ‘¤ ä½¿ç”¨è€…å¸³è™Ÿ | 1 äºº | 3 äºº | ç„¡é™ |
| ğŸ” ä½¿ç”¨è€…æ¬Šé™ç®¡ç† | åƒ…ç®¡ç†å“¡ | ç®¡ç†å“¡/æœƒè¨ˆ/æ¥­å‹™ | ç®¡ç†å“¡/æœƒè¨ˆ/æ¥­å‹™ |
| ğŸ”— é›»å­ç™¼ç¥¨ä¸²æ¥ (Payuni) | âŒ | âœ… | âœ… |
| ğŸ§¾ ç‡Ÿæ¥­ç¨… 401 ç”³å ± | âŒ | âœ… | âœ… |
| ğŸ’° ç‡Ÿæ‰€ç¨…è¨ˆç®—ï¼ˆæ“´å¤§æ›¸å¯©ï¼‰ | âŒ | âŒ | âœ… |
| ğŸ’¾ è³‡æ–™ä¿å­˜æœŸé™ | 1 å¹´ | 3 å¹´ | æ°¸ä¹… |

### 2.3 æˆæœ¬èˆ‡åˆ©æ½¤åˆ†æ

| é …ç›® | é‡‘é¡ |
|------|-----:|
| æ¯æœˆå›ºå®šæˆæœ¬ | NT$1,000 |
| Entry åˆ©æ½¤ | NT$199 - åˆ†æ”¤æˆæœ¬ â‰ˆ NT$150+ |
| Standard åˆ©æ½¤ | NT$899 - åˆ†æ”¤æˆæœ¬ â‰ˆ NT$600+ |
| Pro åˆ©æ½¤ | NT$2,499 - åˆ†æ”¤æˆæœ¬ â‰ˆ NT$1,800+ |
| æç›Šå¹³è¡¡é» | ç´„ 6 å€‹ Entry å®¢æˆ¶ |

### 2.4 é‡‘æµèˆ‡è¯ç›Ÿè¡ŒéŠ·

> é‡‘æµä¸²æ¥èˆ‡è¯ç›Ÿè¡ŒéŠ·åˆ†æ½¤ç³»çµ±åƒè€ƒ **affiliate å°ˆæ¡ˆ**ï¼Œä¸åœ¨æœ¬ SDD ç¯„åœå…§ã€‚

---

## 3. æŠ€è¡“æ¶æ§‹

### 3.1 æ¶æ§‹åœ–

```mermaid
graph TB
    subgraph Client[å®¢æˆ¶ç«¯]
        APP[Flutter App<br/>iOS / Android]
        WEB[è¡ŒéŠ·ç¶²ç«™<br/>Next.js]
    end
    
    subgraph Cloudflare[Cloudflare]
        PAGES[Cloudflare Pages<br/>è¡ŒéŠ·é  + è¯ç›Ÿå¾Œå°]
    end
    
    subgraph Supabase[Supabase]
        AUTH[Authentication<br/>ç”¨æˆ¶èªè­‰]
        DB[(PostgreSQL<br/>è³‡æ–™åº«)]
        STORAGE[Storage<br/>æª”æ¡ˆå„²å­˜]
        EDGE[Edge Functions<br/>ä¼ºæœå™¨é‚è¼¯]
        REALTIME[Realtime<br/>å³æ™‚è¨‚é–±]
    end
    
    subgraph Firebase[Firebase]
        FCM[Cloud Messaging<br/>æ¨æ’­é€šçŸ¥]
    end
    
    subgraph External[å¤–éƒ¨æœå‹™]
        PAYUNI[Payuni<br/>é›»å­ç™¼ç¥¨]
        EMAIL[Email Service<br/>éƒµä»¶é€šçŸ¥]
    end
    
    APP --> AUTH
    APP --> DB
    APP --> STORAGE
    APP --> FCM
    WEB --> PAGES
    PAGES --> DB
    EDGE --> PAYUNI
    EDGE --> EMAIL
```

### 3.2 æŠ€è¡“è¦æ ¼

| å±¤ç´š | æŠ€è¡“ | ç‰ˆæœ¬/è¦æ ¼ | èªªæ˜ |
|------|------|----------|------|
| **ä¸»æ‡‰ç”¨ç¨‹å¼** | Flutter | 3.x | iOS + Android è·¨å¹³å° App |
| **è¡ŒéŠ·ç¶²ç«™** | Next.js | 14+ (App Router) | SEO è‘—é™¸é ã€è¯ç›Ÿè¡ŒéŠ·å¾Œå° |
| **ç¶²ç«™éƒ¨ç½²** | Cloudflare Pages | - | å…¨çƒ CDN |
| **å¾Œç«¯æœå‹™** | Supabase | - | BaaS å¹³å° |
| **è³‡æ–™åº«** | PostgreSQL | 15+ | Supabase è¨—ç®¡ |
| **èªè­‰** | Supabase Auth | - | JWT + Row Level Security |
| **æª”æ¡ˆå„²å­˜** | Supabase Storage | - | S3 ç›¸å®¹ |
| **æ¨æ’­é€šçŸ¥** | Firebase Cloud Messaging | - | iOS/Android æ¨æ’­ï¼ˆå…è²»ï¼‰ |
| **ç‹€æ…‹ç®¡ç†** | Riverpod / Bloc | - | Flutter ç‹€æ…‹ç®¡ç† |
| **æœ¬åœ°å„²å­˜** | Hive / SharedPreferences | - | App æœ¬åœ°å¿«å– |

### 3.3 Flutter å°ˆæ¡ˆçµæ§‹

```
/quote24_app/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ main.dart                    # æ‡‰ç”¨ç¨‹å¼å…¥å£
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ app.dart                 # App æ ¹å…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ routes.dart              # è·¯ç”±è¨­å®š
â”‚   â”‚   â””â”€â”€ theme.dart               # ä¸»é¡Œè¨­å®š
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config/                  # ç’°å¢ƒè¨­å®š
â”‚   â”‚   â”œâ”€â”€ constants/               # å¸¸æ•¸å®šç¾©
â”‚   â”‚   â”œâ”€â”€ exceptions/              # ä¾‹å¤–è™•ç†
â”‚   â”‚   â”œâ”€â”€ network/                 # ç¶²è·¯å±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ api_client.dart
â”‚   â”‚   â”‚   â””â”€â”€ supabase_client.dart
â”‚   â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½å¼
â”‚   â”‚       â”œâ”€â”€ formatters.dart      # æ ¼å¼åŒ–ï¼ˆé‡‘é¡ã€æ—¥æœŸï¼‰
â”‚   â”‚       â””â”€â”€ validators.dart      # é©—è­‰å™¨
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”œâ”€â”€ auth/                    # èªè­‰æ¨¡çµ„
â”‚   â”‚   â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ repositories/
â”‚   â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ usecases/
â”‚   â”‚   â”‚   â””â”€â”€ presentation/
â”‚   â”‚   â”‚       â”œâ”€â”€ screens/
â”‚   â”‚   â”‚       â”œâ”€â”€ widgets/
â”‚   â”‚   â”‚       â””â”€â”€ providers/
â”‚   â”‚   â”œâ”€â”€ dashboard/               # å„€è¡¨æ¿
â”‚   â”‚   â”œâ”€â”€ contacts/                # å®¢æˆ¶/å» å•†ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ quotes/                  # å ±åƒ¹å–®
â”‚   â”‚   â”œâ”€â”€ orders/                  # è¨‚å–®
â”‚   â”‚   â”œâ”€â”€ shipments/               # å‡ºè²¨å–®
â”‚   â”‚   â”œâ”€â”€ invoices/                # ç™¼ç¥¨
â”‚   â”‚   â”œâ”€â”€ inventory/               # é€²éŠ·å­˜
â”‚   â”‚   â”œâ”€â”€ reports/                 # è²¡å‹™å ±è¡¨
â”‚   â”‚   â”œâ”€â”€ tax/                     # ç¨…å‹™ç”³å ±
â”‚   â”‚   â”‚   â”œâ”€â”€ vat/                 # ç‡Ÿæ¥­ç¨… 401
â”‚   â”‚   â”‚   â””â”€â”€ income_tax/          # ç‡Ÿæ‰€ç¨…
â”‚   â”‚   â”œâ”€â”€ notifications/           # é€šçŸ¥ä¸­å¿ƒ
â”‚   â”‚   â””â”€â”€ settings/                # ç³»çµ±è¨­å®š
â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â”œâ”€â”€ widgets/                 # å…±ç”¨å…ƒä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ buttons/
â”‚   â”‚   â”‚   â”œâ”€â”€ cards/
â”‚   â”‚   â”‚   â”œâ”€â”€ dialogs/
â”‚   â”‚   â”‚   â”œâ”€â”€ forms/
â”‚   â”‚   â”‚   â””â”€â”€ tables/
â”‚   â”‚   â””â”€â”€ extensions/              # Dart æ“´å……
â”‚   â””â”€â”€ l10n/                        # å¤šèªç³»ï¼ˆç¹ä¸­ç‚ºä¸»ï¼‰
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ icons/
â”‚   â””â”€â”€ fonts/
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ widget/
â”‚   â””â”€â”€ integration/
â”œâ”€â”€ pubspec.yaml
â””â”€â”€ README.md
```

### 3.4 è¡ŒéŠ·ç¶²ç«™çµæ§‹ (Next.js)

```
/quote24_web/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx                     # é¦–é ï¼ˆç”¢å“ä»‹ç´¹ï¼‰
â”‚   â”œâ”€â”€ pricing/
â”‚   â”‚   â””â”€â”€ page.tsx                 # å®šåƒ¹é é¢
â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â””â”€â”€ page.tsx                 # åŠŸèƒ½ä»‹ç´¹
â”‚   â”œâ”€â”€ blog/
â”‚   â”‚   â”œâ”€â”€ page.tsx                 # éƒ¨è½æ ¼åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ [slug]/
â”‚   â”‚       â””â”€â”€ page.tsx             # æ–‡ç« å…§å®¹
â”‚   â”œâ”€â”€ download/
â”‚   â”‚   â””â”€â”€ page.tsx                 # App ä¸‹è¼‰é 
â”‚   â”œâ”€â”€ affiliate/                   # è¯ç›Ÿè¡ŒéŠ·ï¼ˆåƒè€ƒ affiliate å°ˆæ¡ˆï¼‰
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ layout.tsx
â”œâ”€â”€ components/
â”œâ”€â”€ lib/
â”œâ”€â”€ public/
â””â”€â”€ package.json
```

### 3.5 é–‹ç™¼è¦ç¯„

#### 3.5.1 Flutter å‘½åè¦ç¯„

| é¡å‹ | è¦ç¯„ | ç¯„ä¾‹ |
|------|------|------|
| æª”æ¡ˆåç¨± | snake_case | `quote_form.dart`, `contact_repository.dart` |
| é¡åˆ¥åç¨± | PascalCase | `QuoteForm`, `ContactRepository` |
| è®Šæ•¸/æ–¹æ³• | camelCase | `calculateTotal()`, `contactList` |
| å¸¸æ•¸ | lowerCamelCase / UPPER_SNAKE_CASE | `defaultPadding`, `VAT_RATE` |
| ç§æœ‰æˆå“¡ | _camelCase | `_isLoading`, `_fetchData()` |

#### 3.5.2 è³‡æ–™åº«å‘½åè¦ç¯„

| é¡å‹ | è¦ç¯„ | ç¯„ä¾‹ |
|------|------|------|
| è³‡æ–™è¡¨ | snake_case | `contacts`, `quote_items` |
| æ¬„ä½ | snake_case | `contact_type`, `created_at` |
| å¤–éµ | {table}_id | `contact_id`, `quote_id` |
| ç´¢å¼• | idx_{table}_{column} | `idx_quotes_contact_id` |

#### 3.5.3 Dart è³‡æ–™æ¨¡å‹ç¯„ä¾‹

```dart
// lib/features/contacts/data/models/contact_model.dart

import 'package:freezed_annotation/freezed_annotation.dart';

part 'contact_model.freezed.dart';
part 'contact_model.g.dart';

enum ContactType {
  @JsonValue('CUSTOMER')
  customer,
  @JsonValue('VENDOR')
  vendor,
  @JsonValue('BOTH')
  both,
}

@freezed
class Contact with _$Contact {
  const factory Contact({
    required String id,
    required String organizationId,
    required ContactType contactType,
    required String companyName,
    String? taxId,
    String? contactPerson,
    String? phone,
    String? email,
    String? address,
    @Default(30) int paymentTerms,
    String? notes,
    required DateTime createdAt,
    required DateTime updatedAt,
  }) = _Contact;

  factory Contact.fromJson(Map<String, dynamic> json) =>
      _$ContactFromJson(json);
}

// lib/features/quotes/data/models/quote_model.dart

enum QuoteStatus {
  @JsonValue('DRAFT')
  draft,
  @JsonValue('SENT')
  sent,
  @JsonValue('ACCEPTED')
  accepted,
  @JsonValue('REJECTED')
  rejected,
  @JsonValue('EXPIRED')
  expired,
}

@freezed
class Quote with _$Quote {
  const factory Quote({
    required String id,
    required String organizationId,
    required String contactId,
    Contact? contact,
    required String quoteNumber,
    required DateTime quoteDate,
    required DateTime validUntil,
    @Default(QuoteStatus.draft) QuoteStatus status,
    @Default(0) double subtotal,
    @Default(0) double taxAmount,
    @Default(0) double totalAmount,
    String? notes,
    String? terms,
    @Default([]) List<QuoteItem> items,
    required DateTime createdAt,
    required DateTime updatedAt,
  }) = _Quote;

  factory Quote.fromJson(Map<String, dynamic> json) =>
      _$QuoteFromJson(json);
}

@freezed
class QuoteItem with _$QuoteItem {
  const factory QuoteItem({
    required String id,
    required String quoteId,
    String? productId,
    required String description,
    required double quantity,
    required double unitPrice,
    @Default(0.05) double taxRate,
    required double subtotal,
    @Default(0) int sortOrder,
  }) = _QuoteItem;

  factory QuoteItem.fromJson(Map<String, dynamic> json) =>
      _$QuoteItemFromJson(json);
}
```

---

## 4. è³‡æ–™åº«è¨­è¨ˆ

### 4.1 å¯¦é«”é—œä¿‚åœ– (ERD)

```mermaid
erDiagram
    ORGANIZATIONS ||--o{ USERS : "has"
    ORGANIZATIONS ||--o{ CONTACTS : "has"
    ORGANIZATIONS ||--o{ PRODUCTS : "has"
    ORGANIZATIONS ||--o{ QUOTES : "has"
    ORGANIZATIONS ||--o{ ORDERS : "has"
    ORGANIZATIONS ||--o{ INVOICES : "has"
    ORGANIZATIONS ||--o{ NOTIFICATIONS : "has"
    
    USERS ||--o{ QUOTES : "creates"
    USERS ||--o{ ORDERS : "creates"
    USERS ||--o{ USER_DEVICES : "has"
    
    CONTACTS ||--o{ QUOTES : "receives"
    CONTACTS ||--o{ ORDERS : "places"
    CONTACTS ||--o{ INVOICES : "billed_to"
    
    QUOTES ||--o{ QUOTE_ITEMS : "contains"
    QUOTES ||--o| ORDERS : "converts_to"
    
    ORDERS ||--o{ ORDER_ITEMS : "contains"
    ORDERS ||--o| SHIPMENTS : "ships_via"
    ORDERS ||--o| INVOICES : "bills_via"
    
    SHIPMENTS ||--o{ SHIPMENT_ITEMS : "contains"
    
    INVOICES ||--o{ INVOICE_ITEMS : "contains"
    INVOICES ||--o{ PAYMENTS : "receives"
    
    PRODUCTS ||--o{ QUOTE_ITEMS : "in"
    PRODUCTS ||--o{ ORDER_ITEMS : "in"
    PRODUCTS ||--o{ INVENTORY_TRANSACTIONS : "tracks"
    
    JOURNAL_ENTRIES ||--o{ JOURNAL_LINES : "contains"
    ACCOUNTS ||--o{ JOURNAL_LINES : "debits_credits"
    
    VAT_REPORTS ||--o{ VAT_REPORT_ITEMS : "contains"
    
    ORGANIZATIONS {
        uuid id PK
        string name "å…¬å¸åç¨±"
        string tax_id "çµ±ä¸€ç·¨è™Ÿ"
        string plan "ENTRY | STANDARD | PRO"
        date plan_expires_at "æ–¹æ¡ˆåˆ°æœŸæ—¥"
        jsonb settings "ç³»çµ±è¨­å®š"
        timestamp created_at
    }
    
    USERS {
        uuid id PK
        uuid organization_id FK
        string email "Email"
        string name "å§“å"
        string role "ADMIN | ACCOUNTANT | SALES"
        boolean is_active
        timestamp created_at
    }
    
    USER_DEVICES {
        uuid id PK
        uuid user_id FK
        string device_token "FCM Token"
        string platform "IOS | ANDROID"
        boolean is_active
        timestamp created_at
    }
    
    CONTACTS {
        uuid id PK
        uuid organization_id FK
        string contact_type "CUSTOMER | VENDOR | BOTH"
        string company_name "å…¬å¸åç¨±"
        string tax_id "çµ±ä¸€ç·¨è™Ÿ"
        string contact_person "è¯çµ¡äºº"
        string phone "é›»è©±"
        string email "Email"
        string address "åœ°å€"
        int payment_terms "ä»˜æ¬¾å¤©æ•¸"
        text notes "å‚™è¨»"
        timestamp created_at
        timestamp updated_at
    }
    
    PRODUCTS {
        uuid id PK
        uuid organization_id FK
        string sku "å•†å“ç·¨è™Ÿ"
        string name "å•†å“åç¨±"
        text description "æè¿°"
        decimal unit_price "å–®åƒ¹"
        decimal cost "æˆæœ¬"
        string unit "å–®ä½"
        int stock_quantity "åº«å­˜æ•¸é‡"
        boolean is_active
        boolean track_inventory "è¿½è¹¤åº«å­˜"
        timestamp created_at
        timestamp updated_at
    }
    
    QUOTES {
        uuid id PK
        uuid organization_id FK
        uuid contact_id FK
        uuid created_by FK
        string quote_number "å ±åƒ¹å–®è™Ÿ"
        date quote_date "å ±åƒ¹æ—¥æœŸ"
        date valid_until "æœ‰æ•ˆæœŸé™"
        string status "DRAFT | SENT | ACCEPTED | REJECTED | EXPIRED"
        decimal subtotal "å°è¨ˆ"
        decimal tax_amount "ç¨…é¡"
        decimal total_amount "ç¸½è¨ˆ"
        text notes "å‚™è¨»"
        text terms "æ¢æ¬¾"
        timestamp created_at
        timestamp updated_at
    }
    
    INVOICES {
        uuid id PK
        uuid organization_id FK
        uuid contact_id FK
        uuid order_id FK
        string invoice_number "ç™¼ç¥¨è™Ÿç¢¼"
        string invoice_type "B2B | B2C"
        date invoice_date "ç™¼ç¥¨æ—¥æœŸ"
        date due_date "ä»˜æ¬¾æœŸé™"
        string status "DRAFT | ISSUED | PAID | OVERDUE | CANCELLED"
        decimal subtotal "å°è¨ˆ"
        decimal tax_amount "ç¨…é¡"
        decimal total_amount "ç¸½è¨ˆ"
        decimal paid_amount "å·²ä»˜é‡‘é¡"
        string payuni_invoice_no "Payuni ç™¼ç¥¨è™Ÿç¢¼"
        text notes "å‚™è¨»"
        timestamp created_at
        timestamp updated_at
    }
    
    NOTIFICATIONS {
        uuid id PK
        uuid organization_id FK
        uuid user_id FK
        string type "PAYMENT_DUE | PAYMENT_OVERDUE | QUOTE_EXPIRING | SYSTEM"
        string title "æ¨™é¡Œ"
        text message "å…§å®¹"
        string reference_type "INVOICE | QUOTE | ORDER"
        uuid reference_id FK
        boolean is_read "å·²è®€"
        boolean is_pushed "å·²æ¨æ’­"
        timestamp created_at
    }
```

### 4.2 è³‡æ–™è¡¨è©³ç´°è¦æ ¼

#### 4.2.1 `organizations` - çµ„ç¹”/å…¬å¸è¡¨

| æ¬„ä½åç¨± | è³‡æ–™å‹æ…‹ | ç´„æŸ | èªªæ˜ |
|---------|---------|------|------|
| `id` | UUID | PK, DEFAULT uuid_generate_v4() | ä¸»éµ |
| `name` | VARCHAR(100) | NOT NULL | å…¬å¸åç¨± |
| `tax_id` | VARCHAR(8) | UNIQUE | çµ±ä¸€ç·¨è™Ÿ |
| `plan` | VARCHAR(20) | NOT NULL, DEFAULT 'ENTRY' | è¨‚é–±æ–¹æ¡ˆ |
| `plan_expires_at` | DATE | NULL | æ–¹æ¡ˆåˆ°æœŸæ—¥ |
| `settings` | JSONB | DEFAULT '{}' | ç³»çµ±è¨­å®š |
| `created_at` | TIMESTAMPTZ | NOT NULL, DEFAULT NOW() | å»ºç«‹æ™‚é–“ |
| `updated_at` | TIMESTAMPTZ | NOT NULL, DEFAULT NOW() | æ›´æ–°æ™‚é–“ |

#### 4.2.2 `users` - ä½¿ç”¨è€…è¡¨

| æ¬„ä½åç¨± | è³‡æ–™å‹æ…‹ | ç´„æŸ | èªªæ˜ |
|---------|---------|------|------|
| `id` | UUID | PK, FK â†’ auth.users.id | ä¸»éµ (å°æ‡‰ Supabase Auth) |
| `organization_id` | UUID | FK â†’ organizations.id | æ‰€å±¬çµ„ç¹” |
| `email` | VARCHAR(255) | NOT NULL | Email |
| `name` | VARCHAR(100) | NOT NULL | å§“å |
| `role` | VARCHAR(20) | NOT NULL, DEFAULT 'ADMIN' | è§’è‰²ï¼šADMIN/ACCOUNTANT/SALES |
| `is_active` | BOOLEAN | NOT NULL, DEFAULT TRUE | æ˜¯å¦å•Ÿç”¨ |
| `created_at` | TIMESTAMPTZ | NOT NULL, DEFAULT NOW() | å»ºç«‹æ™‚é–“ |
| `updated_at` | TIMESTAMPTZ | NOT NULL, DEFAULT NOW() | æ›´æ–°æ™‚é–“ |

#### 4.2.3 `user_devices` - ä½¿ç”¨è€…è£ç½®è¡¨ï¼ˆæ¨æ’­ç”¨ï¼‰

| æ¬„ä½åç¨± | è³‡æ–™å‹æ…‹ | ç´„æŸ | èªªæ˜ |
|---------|---------|------|------|
| `id` | UUID | PK, DEFAULT uuid_generate_v4() | ä¸»éµ |
| `user_id` | UUID | FK â†’ users.id, NOT NULL | æ‰€å±¬ä½¿ç”¨è€… |
| `device_token` | VARCHAR(255) | NOT NULL | FCM Token |
| `platform` | VARCHAR(10) | NOT NULL | å¹³å°ï¼šIOS/ANDROID |
| `is_active` | BOOLEAN | NOT NULL, DEFAULT TRUE | æ˜¯å¦å•Ÿç”¨ |
| `created_at` | TIMESTAMPTZ | NOT NULL, DEFAULT NOW() | å»ºç«‹æ™‚é–“ |
| `updated_at` | TIMESTAMPTZ | NOT NULL, DEFAULT NOW() | æ›´æ–°æ™‚é–“ |

#### 4.2.4 `notifications` - é€šçŸ¥è¡¨

| æ¬„ä½åç¨± | è³‡æ–™å‹æ…‹ | ç´„æŸ | èªªæ˜ |
|---------|---------|------|------|
| `id` | UUID | PK, DEFAULT uuid_generate_v4() | ä¸»éµ |
| `organization_id` | UUID | FK â†’ organizations.id, NOT NULL | æ‰€å±¬çµ„ç¹” |
| `user_id` | UUID | FK â†’ users.id, NOT NULL | æ¥æ”¶è€… |
| `type` | VARCHAR(30) | NOT NULL | é¡å‹ |
| `title` | VARCHAR(100) | NOT NULL | æ¨™é¡Œ |
| `message` | TEXT | NOT NULL | å…§å®¹ |
| `reference_type` | VARCHAR(20) | NULL | é—œè¯é¡å‹ï¼šINVOICE/QUOTE/ORDER |
| `reference_id` | UUID | NULL | é—œè¯ ID |
| `is_read` | BOOLEAN | NOT NULL, DEFAULT FALSE | å·²è®€ |
| `is_pushed` | BOOLEAN | NOT NULL, DEFAULT FALSE | å·²æ¨æ’­ |
| `created_at` | TIMESTAMPTZ | NOT NULL, DEFAULT NOW() | å»ºç«‹æ™‚é–“ |

**é€šçŸ¥é¡å‹ (type)**:
- `PAYMENT_DUE` - æ¬¾é …å³å°‡åˆ°æœŸ
- `PAYMENT_OVERDUE` - æ¬¾é …å·²é€¾æœŸ
- `QUOTE_EXPIRING` - å ±åƒ¹å–®å³å°‡åˆ°æœŸ
- `QUOTE_ACCEPTED` - å ±åƒ¹å–®å·²è¢«æ¥å—
- `ORDER_CONFIRMED` - è¨‚å–®å·²ç¢ºèª
- `SYSTEM` - ç³»çµ±é€šçŸ¥

---

## 5. API è¨­è¨ˆè¦æ ¼

### 5.1 API ç¸½è¦½

> Flutter App ç›´æ¥é€é Supabase Client SDK æ“ä½œè³‡æ–™åº«ï¼Œå¤§éƒ¨åˆ† CRUD ä¸éœ€è¦é¡å¤– APIã€‚
> ä»¥ä¸‹åˆ—å‡ºéœ€è¦ Edge Functions è™•ç†çš„è¤‡é›œæ¥­å‹™é‚è¼¯ã€‚

| æ¨¡çµ„ | HTTP Method | Endpoint | èªªæ˜ |
|------|-------------|----------|------|
| **å ±åƒ¹å–®** ||||
| | POST | `/functions/v1/quotes/convert` | å ±åƒ¹å–®è½‰è¨‚å–® |
| | POST | `/functions/v1/quotes/send` | ç™¼é€å ±åƒ¹å–®ï¼ˆEmailï¼‰ |
| **ç™¼ç¥¨** ||||
| | POST | `/functions/v1/invoices/issue` | é–‹ç«‹é›»å­ç™¼ç¥¨ (Payuni) |
| | POST | `/functions/v1/invoices/void` | ä½œå»¢ç™¼ç¥¨ |
| **ç¨…å‹™ç”³å ±** ||||
| | POST | `/functions/v1/tax/vat/generate` | ç”¢ç”Ÿ 401 ç”³å ±æª” |
| | GET | `/functions/v1/tax/vat/preview` | é è¦½ç”³å ±å…§å®¹ |
| | POST | `/functions/v1/tax/income/calculate` | ç‡Ÿæ‰€ç¨…è©¦ç®— |
| **é€šçŸ¥** ||||
| | POST | `/functions/v1/notifications/push` | ç™¼é€æ¨æ’­é€šçŸ¥ |
| | POST | `/functions/v1/notifications/check-due` | æª¢æŸ¥åˆ°æœŸæ¬¾é …ï¼ˆæ’ç¨‹ç”¨ï¼‰ |
| **Webhook** ||||
| | POST | `/functions/v1/webhooks/payuni` | Payuni å›èª¿ |

### 5.2 æ¨æ’­é€šçŸ¥æœå‹™

```typescript
// supabase/functions/notifications/push/index.ts

import { createClient } from '@supabase/supabase-js';
import * as admin from 'firebase-admin';

interface PushNotificationRequest {
  userId: string;
  title: string;
  body: string;
  data?: Record<string, string>;
}

Deno.serve(async (req) => {
  const supabase = createClient(
    Deno.env.get('SUPABASE_URL')!,
    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
  );

  const { userId, title, body, data }: PushNotificationRequest = await req.json();

  // å–å¾—ä½¿ç”¨è€…çš„æ‰€æœ‰è£ç½® Token
  const { data: devices, error } = await supabase
    .from('user_devices')
    .select('device_token, platform')
    .eq('user_id', userId)
    .eq('is_active', true);

  if (error || !devices?.length) {
    return new Response(
      JSON.stringify({ success: false, error: 'No devices found' }),
      { status: 404 }
    );
  }

  // ç™¼é€æ¨æ’­
  const tokens = devices.map(d => d.device_token);
  
  const message = {
    notification: { title, body },
    data: data || {},
    tokens,
  };

  try {
    const response = await admin.messaging().sendEachForMulticast(message);
    
    return new Response(
      JSON.stringify({ 
        success: true, 
        successCount: response.successCount,
        failureCount: response.failureCount 
      }),
      { status: 200 }
    );
  } catch (error) {
    return new Response(
      JSON.stringify({ success: false, error: error.message }),
      { status: 500 }
    );
  }
});
```

### 5.3 æ”¶æ¬¾æé†’æ’ç¨‹æª¢æŸ¥

```typescript
// supabase/functions/notifications/check-due/index.ts

import { createClient } from '@supabase/supabase-js';

Deno.serve(async (req) => {
  const supabase = createClient(
    Deno.env.get('SUPABASE_URL')!,
    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
  );

  const today = new Date().toISOString().split('T')[0];
  const threeDaysLater = new Date(Date.now() + 3 * 24 * 60 * 60 * 1000)
    .toISOString().split('T')[0];

  // æŸ¥è©¢å³å°‡åˆ°æœŸçš„ç™¼ç¥¨ï¼ˆ3å¤©å…§ï¼‰
  const { data: dueSoon, error: dueError } = await supabase
    .from('invoices')
    .select(`
      id, invoice_number, total_amount, due_date,
      contact:contacts(company_name),
      organization:organizations(id)
    `)
    .eq('status', 'ISSUED')
    .gte('due_date', today)
    .lte('due_date', threeDaysLater);

  // æŸ¥è©¢å·²é€¾æœŸçš„ç™¼ç¥¨
  const { data: overdue, error: overdueError } = await supabase
    .from('invoices')
    .select(`
      id, invoice_number, total_amount, due_date,
      contact:contacts(company_name),
      organization:organizations(id)
    `)
    .eq('status', 'ISSUED')
    .lt('due_date', today);

  // ç‚ºæ¯ç­†å»ºç«‹é€šçŸ¥
  const notifications: any[] = [];

  for (const invoice of dueSoon || []) {
    const daysUntilDue = Math.ceil(
      (new Date(invoice.due_date).getTime() - Date.now()) / (1000 * 60 * 60 * 24)
    );
    
    notifications.push({
      organization_id: invoice.organization.id,
      type: 'PAYMENT_DUE',
      title: 'æ¬¾é …å³å°‡åˆ°æœŸ',
      message: `${invoice.contact.company_name} çš„ç™¼ç¥¨ ${invoice.invoice_number}ï¼ˆNT$${invoice.total_amount.toLocaleString()}ï¼‰å°‡æ–¼ ${daysUntilDue} å¤©å¾Œåˆ°æœŸ`,
      reference_type: 'INVOICE',
      reference_id: invoice.id,
    });
  }

  for (const invoice of overdue || []) {
    // æ›´æ–°ç™¼ç¥¨ç‹€æ…‹ç‚ºé€¾æœŸ
    await supabase
      .from('invoices')
      .update({ status: 'OVERDUE' })
      .eq('id', invoice.id);

    const daysOverdue = Math.ceil(
      (Date.now() - new Date(invoice.due_date).getTime()) / (1000 * 60 * 60 * 24)
    );
    
    notifications.push({
      organization_id: invoice.organization.id,
      type: 'PAYMENT_OVERDUE',
      title: 'æ¬¾é …å·²é€¾æœŸ',
      message: `${invoice.contact.company_name} çš„ç™¼ç¥¨ ${invoice.invoice_number}ï¼ˆNT$${invoice.total_amount.toLocaleString()}ï¼‰å·²é€¾æœŸ ${daysOverdue} å¤©`,
      reference_type: 'INVOICE',
      reference_id: invoice.id,
    });
  }

  // æ‰¹æ¬¡å¯«å…¥é€šçŸ¥
  if (notifications.length > 0) {
    await supabase.from('notifications').insert(notifications);
  }

  return new Response(
    JSON.stringify({ 
      success: true, 
      dueSoonCount: dueSoon?.length || 0,
      overdueCount: overdue?.length || 0,
      notificationsCreated: notifications.length 
    }),
    { status: 200 }
  );
});
```

---

## 6. æ¥­å‹™é‚è¼¯è¦æ ¼

### 6.1 å ±åƒ¹å–®è½‰æ›æµç¨‹

```mermaid
flowchart LR
    QUOTE[å ±åƒ¹å–®<br/>DRAFT] --> |ç™¼é€| SENT[å ±åƒ¹å–®<br/>SENT]
    SENT --> |å®¢æˆ¶åŒæ„| ACCEPTED[å ±åƒ¹å–®<br/>ACCEPTED]
    SENT --> |å®¢æˆ¶æ‹’çµ•| REJECTED[å ±åƒ¹å–®<br/>REJECTED]
    SENT --> |è¶…éæœŸé™| EXPIRED[å ±åƒ¹å–®<br/>EXPIRED]
    ACCEPTED --> |è½‰æ›| ORDER[è¨‚å–®<br/>PENDING]
    ORDER --> |ç¢ºèª| CONFIRMED[è¨‚å–®<br/>CONFIRMED]
    CONFIRMED --> |å‡ºè²¨| SHIPMENT[å‡ºè²¨å–®]
    CONFIRMED --> |è«‹æ¬¾| INVOICE[ç™¼ç¥¨<br/>DRAFT]
    INVOICE --> |é–‹ç«‹| ISSUED[ç™¼ç¥¨<br/>ISSUED]
    ISSUED --> |æ”¶æ¬¾| PAID[ç™¼ç¥¨<br/>PAID]
    ISSUED --> |é€¾æœŸ| OVERDUE[ç™¼ç¥¨<br/>OVERDUE]
```

### 6.2 é€šçŸ¥è§¸ç™¼è¦å‰‡

| è§¸ç™¼äº‹ä»¶ | é€šçŸ¥é¡å‹ | è§¸ç™¼æ™‚æ©Ÿ | æ¨æ’­ï¼Ÿ |
|---------|---------|---------|:------:|
| ç™¼ç¥¨å³å°‡åˆ°æœŸ | `PAYMENT_DUE` | åˆ°æœŸå‰ 3 å¤©ï¼ˆæ¯æ—¥æ’ç¨‹æª¢æŸ¥ï¼‰ | âœ… |
| ç™¼ç¥¨å·²é€¾æœŸ | `PAYMENT_OVERDUE` | è¶…éåˆ°æœŸæ—¥ï¼ˆæ¯æ—¥æ’ç¨‹æª¢æŸ¥ï¼‰ | âœ… |
| å ±åƒ¹å–®å³å°‡åˆ°æœŸ | `QUOTE_EXPIRING` | æœ‰æ•ˆæœŸé™å‰ 3 å¤© | âœ… |
| å ±åƒ¹å–®è¢«æ¥å— | `QUOTE_ACCEPTED` | ç‹€æ…‹è®Šæ›´æ™‚ | âœ… |
| è¨‚å–®å·²ç¢ºèª | `ORDER_CONFIRMED` | ç‹€æ…‹è®Šæ›´æ™‚ | âœ… |
| æ”¶åˆ°ä»˜æ¬¾ | `PAYMENT_RECEIVED` | è¨˜éŒ„ä»˜æ¬¾æ™‚ | âœ… |

### 6.3 ç‡Ÿæ¥­ç¨… 401 ç”³å ±æª”ç”¢å‡º

```dart
// lib/features/tax/vat/services/vat_media_generator.dart

class Vat401MediaGenerator {
  /// ç”¢ç”Ÿ 401 ç”³å ± Media æª”
  /// æ ¼å¼ï¼š81 bytes å›ºå®šé•·åº¦è¨˜éŒ„
  String generate(VatReportData data) {
    final lines = <String>[];
    
    // è¡¨é ­è¨˜éŒ„ (H)
    lines.add(_generateHeaderRecord(data));
    
    // éŠ·é …æ˜ç´° (S)
    for (final item in data.salesItems) {
      lines.add(_generateSalesRecord(item, data.taxId));
    }
    
    // é€²é …æ˜ç´° (P)
    for (final item in data.purchaseItems) {
      lines.add(_generatePurchaseRecord(item, data.taxId));
    }
    
    // è¡¨å°¾è¨˜éŒ„ (T)
    lines.add(_generateTrailerRecord(data));
    
    return lines.join('\r\n');
  }

  String _generateHeaderRecord(VatReportData data) {
    // H + çµ±ç·¨(8) + å¹´åº¦(3) + æœŸåˆ¥(2) + ç©ºç™½(67) = 81 bytes
    final year = (data.year - 1911).toString().padLeft(3, '0');
    final period = data.period.toString().padLeft(2, '0');
    return 'H${data.taxId}$year$period${' ' * 67}';
  }

  String _generateSalesRecord(SalesItem item, String sellerTaxId) {
    final yearMonth = _formatYearMonth(item.invoiceDate);
    final amount = item.salesAmount.round().toString().padLeft(12, '0');
    final tax = item.taxAmount.round().toString().padLeft(10, '0');
    
    return 'S31${item.buyerTaxId.padRight(8)}$yearMonth'
           '${item.invoiceNumber.padRight(10)}$amount${item.taxType}$tax'
           '${' ' * 23}';
  }

  String _formatYearMonth(DateTime date) {
    final year = date.year - 1911;
    final month = date.month.toString().padLeft(2, '0');
    return '$year$month';
  }
}
```

### 6.4 ç‡Ÿæ‰€ç¨…æ“´å¤§æ›¸å¯©è¨ˆç®—

```dart
// lib/features/tax/income_tax/services/income_tax_calculator.dart

class IncomeTaxCalculator {
  /// æ“´å¤§æ›¸å¯©ç´”ç›Šç‡è¡¨
  static const Map<String, double> industryProfitRates = {
    '4510': 0.06, // æ±½è»Šé›¶å”®æ¥­
    '4610': 0.06, // å•†å“æ‰¹ç™¼ç¶“ç´€æ¥­
    '4641': 0.06, // å¸ƒç–‹åŠæœé£¾å“æ‰¹ç™¼æ¥­
    '4711': 0.06, // é›¶å”®å¼é‡è²©æ¥­
    '4719': 0.06, // å…¶ä»–ç¶œåˆå•†å“é›¶å”®æ¥­
    '4721': 0.08, // è”¬æœé›¶å”®æ¥­
    '5610': 0.08, // é¤é¤¨æ¥­
    '5820': 0.10, // è»Ÿé«”å‡ºç‰ˆæ¥­
    '6201': 0.10, // é›»è…¦ç¨‹å¼è¨­è¨ˆæ¥­
    '6202': 0.10, // é›»è…¦è«®è©¢æœå‹™æ¥­
    '7010': 0.12, // ä¼æ¥­ç¸½ç®¡ç†æ©Ÿæ§‹
    '7020': 0.10, // ç®¡ç†é¡§å•æ¥­
  };

  /// è¨ˆç®—æ“´å¤§æ›¸å¯©ç‡Ÿæ‰€ç¨…
  /// é©ç”¨æ¢ä»¶ï¼šå¹´ç‡Ÿæ”¶ NT$3,000 è¬ä»¥ä¸‹
  IncomeTaxResult calculate({
    required double revenue,
    required double nonOperatingIncome,
    required String industryCode,
  }) {
    // å–å¾—è©²è¡Œæ¥­çš„æ“´å¤§æ›¸å¯©ç´”ç›Šç‡
    final profitRate = industryProfitRates[industryCode] ?? 0.06;
    
    // èª²ç¨…æ‰€å¾—é¡ = (ç‡Ÿæ¥­æ”¶å…¥ Ã— ç´”ç›Šç‡) + éç‡Ÿæ¥­æ”¶å…¥
    final taxableIncome = (revenue * profitRate + nonOperatingIncome).round();
    
    // ç‡Ÿæ‰€ç¨…ç‡ 20% (2018å¹´èµ·)
    // èª²ç¨…æ‰€å¾—é¡ 12è¬ä»¥ä¸‹å…ç¨…
    int taxAmount = 0;
    if (taxableIncome > 120000) {
      taxAmount = (taxableIncome * 0.20).round();
    }
    
    return IncomeTaxResult(
      year: DateTime.now().year - 1,
      revenue: revenue,
      nonOperatingIncome: nonOperatingIncome,
      industryCode: industryCode,
      profitRate: profitRate,
      taxableIncome: taxableIncome.toDouble(),
      taxAmount: taxAmount.toDouble(),
    );
  }
}

class IncomeTaxResult {
  final int year;
  final double revenue;
  final double nonOperatingIncome;
  final String industryCode;
  final double profitRate;
  final double taxableIncome;
  final double taxAmount;

  IncomeTaxResult({
    required this.year,
    required this.revenue,
    required this.nonOperatingIncome,
    required this.industryCode,
    required this.profitRate,
    required this.taxableIncome,
    required this.taxAmount,
  });
}
```

---

## 7. é é¢åŠŸèƒ½è¦æ ¼

### 7.1 App é é¢çµæ§‹

```
ğŸ“± è¨˜å¸³é€š App
â”œâ”€â”€ ğŸ” èªè­‰
â”‚   â”œâ”€â”€ ç™»å…¥
â”‚   â”œâ”€â”€ è¨»å†Š
â”‚   â””â”€â”€ å¿˜è¨˜å¯†ç¢¼
â”œâ”€â”€ ğŸ  å„€è¡¨æ¿ï¼ˆé¦–é ï¼‰
â”‚   â”œâ”€â”€ æœ¬æœˆç‡Ÿæ”¶æ‘˜è¦
â”‚   â”œâ”€â”€ å¾…è™•ç†äº‹é …
â”‚   â”œâ”€â”€ æ‡‰æ”¶å¸³æ¬¾å¸³é½¡åœ–
â”‚   â””â”€â”€ å¿«é€Ÿæ“ä½œæŒ‰éˆ•
â”œâ”€â”€ ğŸ‘¥ å®¢æˆ¶/å» å•†
â”‚   â”œâ”€â”€ åˆ—è¡¨
â”‚   â””â”€â”€ æ–°å¢/ç·¨è¼¯
â”œâ”€â”€ ğŸ“¦ å•†å“
â”‚   â”œâ”€â”€ åˆ—è¡¨
â”‚   â””â”€â”€ æ–°å¢/ç·¨è¼¯
â”œâ”€â”€ ğŸ“ å ±åƒ¹å–®
â”‚   â”œâ”€â”€ åˆ—è¡¨
â”‚   â”œâ”€â”€ æ–°å¢/ç·¨è¼¯
â”‚   â””â”€â”€ è©³æƒ…ï¼ˆå«è½‰è¨‚å–®ï¼‰
â”œâ”€â”€ ğŸ“‹ è¨‚å–®
â”‚   â”œâ”€â”€ åˆ—è¡¨
â”‚   â”œâ”€â”€ æ–°å¢/ç·¨è¼¯
â”‚   â””â”€â”€ è©³æƒ…ï¼ˆå«å‡ºè²¨ï¼‰
â”œâ”€â”€ ğŸšš å‡ºè²¨å–®
â”‚   â”œâ”€â”€ åˆ—è¡¨
â”‚   â””â”€â”€ è©³æƒ…
â”œâ”€â”€ ğŸ§¾ ç™¼ç¥¨
â”‚   â”œâ”€â”€ åˆ—è¡¨
â”‚   â”œâ”€â”€ æ–°å¢/ç·¨è¼¯
â”‚   â””â”€â”€ è©³æƒ…ï¼ˆå«æ”¶æ¬¾è¨˜éŒ„ï¼‰
â”œâ”€â”€ ğŸ“Š è²¡å‹™å ±è¡¨
â”‚   â”œâ”€â”€ æç›Šè¡¨
â”‚   â”œâ”€â”€ è³‡ç”¢è² å‚µè¡¨
â”‚   â”œâ”€â”€ ç¾é‡‘æµé‡è¡¨
â”‚   â”œâ”€â”€ æ‡‰æ”¶å¸³æ¬¾å¸³é½¡
â”‚   â””â”€â”€ æ‡‰ä»˜å¸³æ¬¾å¸³é½¡
â”œâ”€â”€ ğŸ’° ç¨…å‹™ç”³å ± [Standard+]
â”‚   â”œâ”€â”€ ç‡Ÿæ¥­ç¨… 401
â”‚   â”‚   â”œâ”€â”€ æœŸåˆ¥é¸æ“‡
â”‚   â”‚   â”œâ”€â”€ è³‡æ–™é è¦½
â”‚   â”‚   â””â”€â”€ ç”¢å‡ºç”³å ±æª”
â”‚   â””â”€â”€ ç‡Ÿæ‰€ç¨… [Pro]
â”‚       â”œâ”€â”€ è³‡æ–™è¼¸å…¥
â”‚       â””â”€â”€ è©¦ç®—çµæœ
â”œâ”€â”€ ğŸ”” é€šçŸ¥ä¸­å¿ƒ
â”‚   â””â”€â”€ é€šçŸ¥åˆ—è¡¨
â””â”€â”€ âš™ï¸ è¨­å®š
    â”œâ”€â”€ å…¬å¸è³‡æ–™
    â”œâ”€â”€ ä½¿ç”¨è€…ç®¡ç† [å¤šäººæ–¹æ¡ˆ]
    â”œâ”€â”€ é›»å­ç™¼ç¥¨è¨­å®š [Standard+]
    â”œâ”€â”€ é€šçŸ¥è¨­å®š
    â””â”€â”€ å¸³è™Ÿèˆ‡è¨‚é–±
```

### 7.2 å„€è¡¨æ¿è¨­è¨ˆ

**åŠŸèƒ½**:
- æœ¬æœˆç‡Ÿæ”¶æ‘˜è¦å¡ç‰‡ï¼ˆç‡Ÿæ”¶ã€å¾…æ”¶æ¬¾ã€å·²æ”¶æ¬¾ï¼‰
- å¾…è™•ç†äº‹é …æé†’ï¼ˆå¾…ç¢ºèªè¨‚å–®ã€é€¾æœŸç™¼ç¥¨ã€å³å°‡åˆ°æœŸå ±åƒ¹ï¼‰
- æ‡‰æ”¶å¸³æ¬¾å¸³é½¡åœ“é¤…åœ–
- è¿‘æœŸæ”¶æ¬¾è¨˜éŒ„åˆ—è¡¨
- å¿«é€Ÿæ“ä½œæŒ‰éˆ•ï¼ˆæ–°å¢å ±åƒ¹ã€æ–°å¢ç™¼ç¥¨ï¼‰

### 7.3 é€šçŸ¥ä¸­å¿ƒè¨­è¨ˆ

**åŠŸèƒ½**:
- ä¾æ™‚é–“æ’åºçš„é€šçŸ¥åˆ—è¡¨
- æœªè®€/å·²è®€ç‹€æ…‹æ¨™ç¤º
- é»æ“Šé€šçŸ¥è·³è½‰è‡³ç›¸é—œé é¢
- æ¨™è¨˜å…¨éƒ¨å·²è®€
- æ¸…é™¤å·²è®€é€šçŸ¥

---

## 8. é–‹ç™¼éšæ®µè¦åŠƒ

### 8.1 Phase 1ï¼šæ ¸å¿ƒåŸºç¤ (MVP)

**é è¨ˆæ™‚ç¨‹**: 6-8 é€±

**åŠŸèƒ½ç¯„åœ**:
- [ ] Flutter å°ˆæ¡ˆæ¶æ§‹å»ºç½®
- [ ] Supabase å°ˆæ¡ˆè¨­å®š
- [ ] ç”¨æˆ¶èªè­‰ï¼ˆè¨»å†Šã€ç™»å…¥ã€å¿˜è¨˜å¯†ç¢¼ï¼‰
- [ ] çµ„ç¹”/å…¬å¸è¨­å®š
- [ ] å®¢æˆ¶/å» å•†ç®¡ç† CRUD
- [ ] å•†å“ç®¡ç† CRUD
- [ ] å ±åƒ¹å–®å®Œæ•´æµç¨‹
- [ ] å„€è¡¨æ¿åŸºç¤ç‰ˆ
- [ ] åŸºæœ¬è²¡å‹™å ±è¡¨ï¼ˆæç›Šè¡¨ï¼‰
- [ ] App æ¨æ’­é€šçŸ¥åŸºç¤æ¶æ§‹

**äº¤ä»˜ç‰©**:
- å¯é‹ä½œçš„ MVP ç‰ˆæœ¬
- Entry æ–¹æ¡ˆå¯é–‹å§‹æ”¶è²»

### 8.2 Phase 2ï¼šå®Œæ•´äº¤æ˜“æµç¨‹

**é è¨ˆæ™‚ç¨‹**: 4-5 é€±

**åŠŸèƒ½ç¯„åœ**:
- [ ] è¨‚å–®ç®¡ç†
- [ ] å‡ºè²¨å–®ç®¡ç†
- [ ] ç™¼ç¥¨ç®¡ç†ï¼ˆå…§éƒ¨ç™¼ç¥¨ï¼Œéé›»å­ç™¼ç¥¨ï¼‰
- [ ] æ”¶æ¬¾è¨˜éŒ„
- [ ] å®Œæ•´è²¡å‹™å ±è¡¨ï¼ˆè³‡ç”¢è² å‚µè¡¨ã€ç¾é‡‘æµé‡è¡¨ï¼‰
- [ ] é€²éŠ·å­˜åŸºç¤åŠŸèƒ½
- [ ] é€šçŸ¥ä¸­å¿ƒå®Œæ•´åŠŸèƒ½
- [ ] æ”¶æ¬¾æé†’æ’ç¨‹ï¼ˆApp æ¨æ’­ï¼‰

### 8.3 Phase 3ï¼šç‡Ÿæ¥­ç¨…ç”³å ±

**é è¨ˆæ™‚ç¨‹**: 2-3 é€±

**åŠŸèƒ½ç¯„åœ**:
- [ ] 401 ç”³å ±è³‡æ–™å½™æ•´
- [ ] Media ç”³å ±æª”ç”¢å‡º
- [ ] PDF é è¦½
- [ ] ç”³å ±è¨˜éŒ„ç®¡ç†

**äº¤ä»˜ç‰©**:
- Standard æ–¹æ¡ˆå¯é–‹å§‹æ”¶è²»

### 8.4 Phase 4ï¼šé›»å­ç™¼ç¥¨ä¸²æ¥

**é è¨ˆæ™‚ç¨‹**: 2-3 é€±

**åŠŸèƒ½ç¯„åœ**:
- [ ] Payuni å¸³è™Ÿè¨­å®š
- [ ] B2B ç™¼ç¥¨é–‹ç«‹
- [ ] B2C ç™¼ç¥¨é–‹ç«‹
- [ ] ç™¼ç¥¨ä½œå»¢/æŠ˜è®“
- [ ] Webhook å›èª¿è™•ç†

### 8.5 Phase 5ï¼šç‡Ÿæ‰€ç¨…è¨ˆç®—

**é è¨ˆæ™‚ç¨‹**: 2 é€±

**åŠŸèƒ½ç¯„åœ**:
- [ ] æ“´å¤§æ›¸å¯©ç´”ç›Šç‡è³‡æ–™åº«
- [ ] ç¨…é¡è©¦ç®—åŠŸèƒ½
- [ ] ç”³å ±æ›¸è¡¨ç”¢å‡º

**äº¤ä»˜ç‰©**:
- Pro æ–¹æ¡ˆå®Œæ•´åŠŸèƒ½

### 8.6 Phase 6ï¼šè¡ŒéŠ·ç¶²ç«™

**é è¨ˆæ™‚ç¨‹**: 2-3 é€±

**åŠŸèƒ½ç¯„åœ**:
- [ ] Next.js å°ˆæ¡ˆå»ºç½®
- [ ] ç”¢å“ä»‹ç´¹é é¢
- [ ] å®šåƒ¹é é¢
- [ ] åŠŸèƒ½ä»‹ç´¹é é¢
- [ ] App ä¸‹è¼‰é 
- [ ] SEO å„ªåŒ–
- [ ] è¯ç›Ÿè¡ŒéŠ·æ•´åˆï¼ˆåƒè€ƒ affiliate å°ˆæ¡ˆï¼‰

---

## 9. é©—è­‰è¨ˆç•«

### 9.1 è‡ªå‹•åŒ–æ¸¬è©¦

**å–®å…ƒæ¸¬è©¦**:
- ç¨…é¡è¨ˆç®—é‚è¼¯
- å ±åƒ¹å–®é‡‘é¡è¨ˆç®—
- 401 Media æª”æ ¼å¼ç”¢å‡º
- é€šçŸ¥è§¸ç™¼é‚è¼¯

**Widget æ¸¬è©¦**:
- è¡¨å–®é©—è­‰
- åˆ—è¡¨é¡¯ç¤º

**æ•´åˆæ¸¬è©¦**:
- å ±åƒ¹å–® â†’ è¨‚å–® â†’ ç™¼ç¥¨ è½‰æ›æµç¨‹
- Payuni API ä¸²æ¥
- FCM æ¨æ’­

### 9.2 æ‰‹å‹•é©—è­‰é …ç›®

| é …ç›® | é©—è­‰å…§å®¹ |
|------|---------|
| å ±åƒ¹å–®æµç¨‹ | æ–°å¢ â†’ ç™¼é€ â†’ è½‰è¨‚å–® â†’ å‡ºè²¨ â†’ é–‹ç™¼ç¥¨ |
| è²¡å‹™å ±è¡¨ | æ•¸å­—æ­£ç¢ºæ€§ã€å ±è¡¨æ ¼å¼ |
| 401 ç”³å ± | ç”³å ±æª”æ ¼å¼ã€é‡‘é¡æ­£ç¢ºæ€§ |
| é›»å­ç™¼ç¥¨ | B2B/B2C é–‹ç«‹ã€ä½œå»¢æµç¨‹ |
| æ¨æ’­é€šçŸ¥ | iOS/Android æ¨æ’­ã€æ’ç¨‹è§¸ç™¼ |
| æ¬Šé™æ§ç®¡ | ä¸åŒè§’è‰²çš„å­˜å–é™åˆ¶ |

---

## 10. é™„éŒ„

### 10.1 åè©å°ç…§è¡¨

| ä¸­æ–‡è¡“èª | è‹±æ–‡å°æ‡‰ | èªªæ˜ |
|---------|---------|------|
| å ±åƒ¹å–® | Quote | å‘å®¢æˆ¶æä¾›çš„å ±åƒ¹æ–‡ä»¶ |
| è¨‚å–® | Order | å®¢æˆ¶ç¢ºèªçš„æ¡è³¼å–® |
| å‡ºè²¨å–® | Shipment | å•†å“å‡ºè²¨è¨˜éŒ„ |
| ç™¼ç¥¨ | Invoice | è«‹æ¬¾æ†‘è­‰ |
| çµ±ä¸€ç·¨è™Ÿ | Tax ID | å°ç£ç‡Ÿæ¥­äººè­˜åˆ¥ç¢¼ (8ç¢¼) |
| ç‡Ÿæ¥­ç¨… | VAT | Value Added Tax (5%) |
| ç‡Ÿæ‰€ç¨… | Income Tax | ç‡Ÿåˆ©äº‹æ¥­æ‰€å¾—ç¨… (20%) |
| æ“´å¤§æ›¸å¯© | Expanded Audit | ç°¡åŒ–çš„ç‡Ÿæ‰€ç¨…ç”³å ±æ–¹å¼ |
| ç´”ç›Šç‡ | Profit Rate | æ“´å¤§æ›¸å¯©é©ç”¨çš„è¡Œæ¥­ç´”ç›Šç‡ |

### 10.2 ç‡Ÿæ¥­ç¨…ç”³å ±æœŸåˆ¥

| æœŸåˆ¥ | ç”³å ±æœˆä»½ç¯„åœ | ç”³å ±æˆªæ­¢æ—¥ |
|------|-------------|-----------|
| ç¬¬ 1 æœŸ | 1-2 æœˆ | 3/15 |
| ç¬¬ 2 æœŸ | 3-4 æœˆ | 5/15 |
| ç¬¬ 3 æœŸ | 5-6 æœˆ | 7/15 |
| ç¬¬ 4 æœŸ | 7-8 æœˆ | 9/15 |
| ç¬¬ 5 æœŸ | 9-10 æœˆ | 11/15 |
| ç¬¬ 6 æœŸ | 11-12 æœˆ | éš”å¹´ 1/15 |

### 10.3 ä½¿ç”¨è€…è§’è‰²æ¬Šé™

| åŠŸèƒ½ | ç®¡ç†å“¡ | æœƒè¨ˆ | æ¥­å‹™ |
|------|:------:|:----:|:----:|
| ç³»çµ±è¨­å®š | âœ… | âŒ | âŒ |
| ä½¿ç”¨è€…ç®¡ç† | âœ… | âŒ | âŒ |
| å®¢æˆ¶ç®¡ç† | âœ… | âœ… | âœ… |
| å ±åƒ¹å–® | âœ… | âœ… | âœ… |
| è¨‚å–® | âœ… | âœ… | ğŸ‘ï¸ |
| ç™¼ç¥¨ | âœ… | âœ… | ğŸ‘ï¸ |
| æ”¶æ¬¾è¨˜éŒ„ | âœ… | âœ… | âŒ |
| è²¡å‹™å ±è¡¨ | âœ… | âœ… | âŒ |
| ç¨…å‹™ç”³å ± | âœ… | âœ… | âŒ |
| é€šçŸ¥ä¸­å¿ƒ | âœ… | âœ… | âœ… |

> ğŸ‘ï¸ = åƒ…æª¢è¦–æ¬Šé™

---

## 11. ç‰ˆæœ¬æ­·ç¨‹

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´èªªæ˜ |
|------|------|---------|
| 1.0 | 2026-01-09 | åˆç‰ˆå»ºç«‹ |
| 1.1 | 2026-01-09 | æŠ€è¡“æ¶æ§‹èª¿æ•´ç‚º Flutter App + Next.js è¡ŒéŠ·é ï¼›ç§»é™¤ LINE æé†’ï¼Œæ”¹ç”¨ App æ¨æ’­ï¼›è¯ç›Ÿè¡ŒéŠ·åƒè€ƒ affiliate å°ˆæ¡ˆ |
