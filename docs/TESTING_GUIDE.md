# ğŸ§ª æ¸¬è©¦æŒ‡å— | Testing Guide

æœ¬æ–‡æª”èªªæ˜å¦‚ä½•åŸ·è¡Œ Supabase è³‡æ–™åº«å’ŒåŠŸèƒ½æ¸¬è©¦ã€‚

---

## ğŸ“‹ ç›®éŒ„

1. [æ¸¬è©¦å‰æº–å‚™](#æ¸¬è©¦å‰æº–å‚™)
2. [é€£æ¥æ¸¬è©¦](#1-é€£æ¥æ¸¬è©¦)
3. [èªè­‰æ¸¬è©¦](#2-èªè­‰æ¸¬è©¦)
4. [CRUD æ¸¬è©¦](#3-crud-æ¸¬è©¦)
5. [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ)

---

## æ¸¬è©¦å‰æº–å‚™

### 1. ç¢ºèªç’°å¢ƒè®Šæ•¸

ç¢ºèª `.env.local` åŒ…å«æ­£ç¢ºçš„ Supabase è¨­å®šï¼š

```bash
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

### 2. ç¢ºèª Migration å®Œæˆ

åŸ·è¡Œé©—è­‰è…³æœ¬ç¢ºèªæ‰€æœ‰ 19 å€‹è¡¨éƒ½å·²å»ºç«‹ï¼š

```sql
-- åœ¨ Supabase Dashboard > SQL Editor åŸ·è¡Œ
SELECT tablename
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY tablename;
```

æ‡‰è©²çœ‹åˆ° **19+ å€‹è¡¨**ï¼ˆåŒ…å«ç³»çµ±é è¨­è¡¨ï¼‰ã€‚

---

## 1. é€£æ¥æ¸¬è©¦

æ¸¬è©¦ Supabase å®¢æˆ¶ç«¯é€£æ¥å’Œè³‡æ–™åº«å¯ç”¨æ€§ã€‚

### åŸ·è¡Œæ¸¬è©¦

```bash
npx tsx scripts/test-supabase-connection.ts
```

### é æœŸçµæœ

```
âœ… ç’°å¢ƒè®Šæ•¸å®Œæ•´
âœ… å®¢æˆ¶ç«¯å»ºç«‹æˆåŠŸ
âœ… è³‡æ–™åº«é€£æ¥æ­£å¸¸
âœ… 19/19 å€‹è¡¨å­˜åœ¨
âš ï¸ RLS é˜»æ“‹åŒ¿åæŸ¥è©¢ï¼ˆé æœŸè¡Œç‚ºï¼‰

æˆåŠŸç‡: 80%
```

### å¦‚æœå¤±æ•—

- æª¢æŸ¥ `.env.local` è¨­å®š
- ç¢ºèª Supabase å°ˆæ¡ˆç‹€æ…‹
- ç¢ºèª Migration å·²å®Œæˆ

---

## 2. èªè­‰æ¸¬è©¦

æ¸¬è©¦ä½¿ç”¨è€…è¨»å†Šã€ç™»å…¥ã€ç™»å‡ºæµç¨‹ã€‚

### é¸é … A: ä½¿ç”¨ Mailinatorï¼ˆæ¨è–¦ï¼‰

å…è²»çš„æ¸¬è©¦ Email æœå‹™ï¼Œç„¡éœ€è¨»å†Šã€‚

#### æ­¥é©Ÿ

1. **åŸ·è¡Œæ¸¬è©¦è…³æœ¬**

```bash
npx tsx scripts/test-auth-with-mailinator.ts
```

2. **æŸ¥çœ‹æ¸¬è©¦ Email**

è…³æœ¬æœƒé¡¯ç¤º Email åœ°å€ï¼Œä¾‹å¦‚ï¼š
```
Email: quotation-test-1234567890@mailinator.com
```

3. **å‰å¾€ Mailinator æ”¶ä¿¡**ï¼ˆå¦‚éœ€ç¢ºèªï¼‰

- ç¶²å€ï¼šhttps://www.mailinator.com/
- è¼¸å…¥ï¼š`quotation-test-1234567890`ï¼ˆå»æ‰ @mailinator.comï¼‰
- é»æ“Šç¢ºèªéƒµä»¶ä¸­çš„é€£çµ

4. **é æœŸçµæœ**

å¦‚æœ **Email ç¢ºèªå·²é—œé–‰**ï¼š
```
âœ… è¨»å†ŠæˆåŠŸ
âœ… ç™»å…¥æˆåŠŸ
âœ… å–å¾—ä½¿ç”¨è€…è³‡è¨ŠæˆåŠŸ
âœ… ç™»å‡ºæˆåŠŸ
```

å¦‚æœ **éœ€è¦ Email ç¢ºèª**ï¼š
```
âœ… è¨»å†ŠæˆåŠŸ
âš ï¸ Email éœ€è¦ç¢ºèª
```

### é¸é … B: æ‰‹å‹•å»ºç«‹æ¸¬è©¦ä½¿ç”¨è€…

é©åˆå¿«é€Ÿæ¸¬è©¦ï¼Œç„¡éœ€è™•ç† Email ç¢ºèªã€‚

#### æ­¥é©Ÿ

1. **å‰å¾€ Supabase Dashboard**
   - Authentication > Users
   - é»æ“Š **"Add user"**

2. **å»ºç«‹æ¸¬è©¦ä½¿ç”¨è€…**
   - Email: `test@example.com`
   - Password: `TestPassword123!`
   - âœ… å‹¾é¸ **"Auto Confirm User"**

3. **æ¸¬è©¦ç™»å…¥**

```typescript
// å¯ä»¥ç”¨é€™å€‹å¸³è™ŸåŸ·è¡Œ CRUD æ¸¬è©¦
npx tsx scripts/test-crud-operations.ts test@example.com TestPassword123!
```

### é¸é … C: é—œé–‰ Email ç¢ºèªï¼ˆé–‹ç™¼ç’°å¢ƒï¼‰

**âš ï¸ åƒ…é™é–‹ç™¼ç’°å¢ƒä½¿ç”¨**

1. å‰å¾€ **Supabase Dashboard > Authentication > Settings**
2. æ‰¾åˆ° **Email Auth** å€å¡Š
3. é—œé–‰ **"Enable email confirmations"**
4. å„²å­˜è®Šæ›´

å®Œæˆå¾Œï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½• Email æ ¼å¼è¨»å†Šæ¸¬è©¦å¸³è™Ÿã€‚

---

## 3. CRUD æ¸¬è©¦

æ¸¬è©¦å®¢æˆ¶å’Œç”¢å“çš„å»ºç«‹ã€è®€å–ã€æ›´æ–°ã€åˆªé™¤åŠŸèƒ½ã€‚

### å‰ææ¢ä»¶

éœ€è¦ä¸€å€‹å·²ç¢ºèªçš„æ¸¬è©¦å¸³è™Ÿã€‚å¯ä½¿ç”¨ï¼š
- Mailinator å»ºç«‹çš„å¸³è™Ÿ
- Dashboard æ‰‹å‹•å»ºç«‹çš„å¸³è™Ÿ

### åŸ·è¡Œæ¸¬è©¦

```bash
npx tsx scripts/test-crud-operations.ts <email> <password>
```

### ç¯„ä¾‹

```bash
# ä½¿ç”¨ Mailinator å¸³è™Ÿ
npx tsx scripts/test-crud-operations.ts quotation-test-123@mailinator.com TestPassword123!

# æˆ–ä½¿ç”¨æ‰‹å‹•å»ºç«‹çš„å¸³è™Ÿ
npx tsx scripts/test-crud-operations.ts test@example.com TestPassword123!
```

### æ¸¬è©¦å…§å®¹

1. **ä½¿ç”¨è€…ç™»å…¥** - é©—è­‰èªè­‰åŠŸèƒ½
2. **å®¢æˆ¶ CRUD**
   - âœ… å»ºç«‹å®¢æˆ¶
   - âœ… è®€å–å®¢æˆ¶
   - âœ… æ›´æ–°å®¢æˆ¶
   - âœ… åˆªé™¤å®¢æˆ¶
3. **ç”¢å“ CRUD**
   - âœ… å»ºç«‹ç”¢å“
   - âœ… è®€å–ç”¢å“
   - âœ… æ›´æ–°ç”¢å“
   - âœ… åˆªé™¤ç”¢å“

### é æœŸçµæœ

```
ğŸ“Š CRUD æ¸¬è©¦çµæœæ‘˜è¦
ç¸½æ¸¬è©¦æ•¸: 9
âœ… é€šé: 9
âŒ å¤±æ•—: 0
æˆåŠŸç‡: 100.0%

ğŸ‰ æ‰€æœ‰ CRUD æ¸¬è©¦é€šéï¼è³‡æ–™åº«æ“ä½œåŠŸèƒ½æ­£å¸¸ï¼
```

### æ¸¬è©¦è³‡æ–™

æ¸¬è©¦æœƒå»ºç«‹ä»¥ä¸‹è³‡æ–™ï¼š

**å®¢æˆ¶è³‡æ–™**
- å…¬å¸åç¨±ï¼šæ¸¬è©¦å®¢æˆ¶å…¬å¸
- Email: customer@test.com
- ç¨…ç±ç·¨è™Ÿï¼š12345678

**ç”¢å“è³‡æ–™**
- åç¨±ï¼šé«˜æ•ˆèƒ½ä¼ºæœå™¨
- SKU: SRV-HP-001
- å–®åƒ¹ï¼šNT$ 150,000

**æ¸…ç†**ï¼šæ¸¬è©¦çµæŸå¾Œæœƒè‡ªå‹•åˆªé™¤æ‰€æœ‰æ¸¬è©¦è³‡æ–™ã€‚

---

## å¸¸è¦‹å•é¡Œ

### Q1: Email æ ¼å¼ç„¡æ•ˆ

**å•é¡Œ**ï¼š`Email address "xxx@example.com" is invalid`

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨ Mailinatorï¼ˆæ¨è–¦ï¼‰
2. åœ¨ Dashboard æ‰‹å‹•å»ºç«‹ä½¿ç”¨è€…
3. é—œé–‰ Email ç¢ºèªè¦æ±‚

### Q2: Email æœªç¢ºèª

**å•é¡Œ**ï¼š`Email not confirmed`

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. å‰å¾€ Mailinator é»æ“Šç¢ºèªé€£çµ
2. åœ¨ Dashboard æ‰‹å‹•ç¢ºèªä½¿ç”¨è€…
3. å»ºç«‹æ–°ä½¿ç”¨è€…æ™‚å‹¾é¸ "Auto Confirm User"

### Q3: RLS é˜»æ“‹æŸ¥è©¢

**å•é¡Œ**ï¼š`permission denied for table xxx`

**èªªæ˜**ï¼šé€™æ˜¯ **æ­£å¸¸è¡Œç‚º**ã€‚RLSï¼ˆRow Level Securityï¼‰ç­–ç•¥ç¢ºä¿ï¼š
- åŒ¿åä½¿ç”¨è€…ç„¡æ³•å­˜å–è³‡æ–™
- ä½¿ç”¨è€…åªèƒ½å­˜å–è‡ªå·±å»ºç«‹çš„è³‡æ–™

**è§£æ±ºæ–¹æ¡ˆ**ï¼šç¢ºä¿å·²ç™»å…¥å¾Œå†é€²è¡Œ CRUD æ“ä½œã€‚

### Q4: é€£æ¥å¤±æ•—

**å•é¡Œ**ï¼šç„¡æ³•é€£æ¥åˆ° Supabase

**æª¢æŸ¥é …ç›®**ï¼š
1. `.env.local` è¨­å®šæ­£ç¢º
2. Supabase å°ˆæ¡ˆç‹€æ…‹æ­£å¸¸
3. ç¶²è·¯é€£ç·šæ­£å¸¸
4. API Key æœªéæœŸ

---

## æ¸¬è©¦æµç¨‹å»ºè­°

### ç¬¬ä¸€æ¬¡æ¸¬è©¦

```bash
# 1. æ¸¬è©¦é€£æ¥
npx tsx scripts/test-supabase-connection.ts

# 2. å»ºç«‹æ¸¬è©¦å¸³è™Ÿï¼ˆé¸æ“‡ä¸€ç¨®æ–¹å¼ï¼‰
#    æ–¹å¼ A: ä½¿ç”¨ Mailinator
npx tsx scripts/test-auth-with-mailinator.ts

#    æ–¹å¼ B: åœ¨ Dashboard æ‰‹å‹•å»ºç«‹
#    (Authentication > Users > Add user)

# 3. æ¸¬è©¦ CRUD
npx tsx scripts/test-crud-operations.ts <email> <password>
```

### æ—¥å¸¸é–‹ç™¼æ¸¬è©¦

æœ‰äº†æ¸¬è©¦å¸³è™Ÿå¾Œï¼Œåªéœ€è¦åŸ·è¡Œ CRUD æ¸¬è©¦ï¼š

```bash
npx tsx scripts/test-crud-operations.ts test@example.com TestPassword123!
```

---

## ä¸‹ä¸€æ­¥

å®ŒæˆåŸºæœ¬æ¸¬è©¦å¾Œï¼Œå¯ä»¥ç¹¼çºŒï¼š

1. âœ… æ¸¬è©¦ RBAC æ¬Šé™ç³»çµ±
2. âœ… æ¸¬è©¦å ±åƒ¹å–®å»ºç«‹æµç¨‹
3. âœ… æ•´åˆå‰ç«¯èªè­‰åŠŸèƒ½
4. âœ… å»ºç«‹æ›´å¤šæ¸¬è©¦æ¡ˆä¾‹

---

## ç›¸é—œæ–‡æª”

- [èªè­‰è¨­å®šæŒ‡å—](./AUTH_SETUP_GUIDE.md) - è©³ç´°çš„èªè­‰ç³»çµ±è¨­å®šèªªæ˜
- [Supabase å®˜æ–¹æ–‡æª”](https://supabase.com/docs) - Supabase å®Œæ•´æ–‡æª”
- [RLS ç­–ç•¥èªªæ˜](https://supabase.com/docs/guides/auth/row-level-security) - RLS å®‰å…¨ç­–ç•¥

---

**æ¸¬è©¦æ„‰å¿«ï¼** ğŸ‰

å¦‚æœ‰å•é¡Œï¼Œè«‹åƒè€ƒï¼š
- `docs/AUTH_SETUP_GUIDE.md` - èªè­‰å•é¡Œ
- `ISSUELOG.md` - å·²çŸ¥å•é¡Œå’Œè§£æ±ºæ–¹æ¡ˆ
- Supabase Dashboard Logs - å³æ™‚éŒ¯èª¤è¨Šæ¯
