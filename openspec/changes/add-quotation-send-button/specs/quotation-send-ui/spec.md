# Spec: quotation-send-ui

## Overview
報價單列表寄送功能使用者介面規格，包含單一寄送按鈕、批次寄送按鈕，以及寄送確認彈窗。

---

## ADDED Requirements

### Requirement: 在報價單列表每一列新增寄送按鈕
**Priority**: High
**Status**: Proposed

系統 SHALL 在報價單列表頁面（`QuotationList.tsx`）的操作欄位中，於「編輯」按鈕旁新增「寄送」按鈕。

#### Scenario: 使用者點擊單一報價單的寄送按鈕
**Given**: 使用者在報價單列表頁面
**When**: 使用者點擊某一列報價單的「寄送」按鈕
**Then**:
- 系統顯示寄送確認彈窗
- 彈窗包含該報價單的客戶資料和預設郵件內容
- 如果客戶沒有電子郵件，按鈕為 disabled 狀態並顯示提示訊息

#### Scenario: 客戶沒有電子郵件地址
**Given**: 某個報價單的客戶資料中沒有 email 欄位
**When**: 使用者查看該報價單列表
**Then**:
- 該列的「寄送」按鈕為 disabled 狀態
- 滑鼠懸停時顯示工具提示：「客戶沒有電子郵件地址」

---

### Requirement: 批次寄送按鈕
**Priority**: High
**Status**: Proposed

系統 SHALL 在批次操作區域新增「批次寄送」按鈕，允許使用者一次寄送多個報價單。

#### Scenario: 使用者選擇多個報價單並批次寄送
**Given**: 使用者已開啟批次操作模式並選擇了 3 個報價單
**When**: 使用者點擊「批次寄送」按鈕
**Then**:
- 系統顯示批次寄送確認彈窗
- 彈窗顯示即將寄送的報價單數量和客戶列表
- 彈窗提供批次郵件主旨和內容編輯欄位

#### Scenario: 選擇的報價單中有客戶沒有電子郵件
**Given**: 使用者選擇了 5 個報價單，其中 2 個客戶沒有電子郵件
**When**: 使用者點擊「批次寄送」按鈕
**Then**:
- 系統顯示警告訊息：「有 2 個客戶沒有電子郵件地址，將無法寄送」
- 列出沒有電子郵件的客戶名稱
- 提供選項：「繼續寄送其他客戶」或「取消」

---

### Requirement: 寄送確認彈窗
**Priority**: High
**Status**: Proposed

系統 SHALL 提供寄送確認彈窗，讓使用者在寄送前確認收件人資訊並編輯郵件內容。

#### Scenario: 顯示單一報價單寄送確認彈窗
**Given**: 使用者點擊了某個報價單的「寄送」按鈕
**When**: 系統顯示寄送確認彈窗
**Then**:
- 彈窗標題：「寄送報價單」
- 顯示以下資訊：
  - 報價單編號
  - 客戶名稱
  - 客戶電子郵件地址（唯讀）
- 提供以下可編輯欄位：
  - 郵件主旨（預設值：「報價單 #{quotation_number}」）
  - 郵件內容（預設值：包含報價單摘要和查看連結的範本）
- 提供「確認寄送」和「取消」按鈕

#### Scenario: 使用者編輯郵件內容
**Given**: 寄送確認彈窗已開啟
**When**: 使用者修改郵件主旨或內容
**Then**:
- 系統保留使用者的編輯內容
- 點擊「確認寄送」時使用修改後的內容發送郵件

#### Scenario: 確認寄送後的載入狀態
**Given**: 使用者在寄送確認彈窗點擊「確認寄送」
**When**: 系統正在發送郵件
**Then**:
- 「確認寄送」按鈕顯示載入中狀態（disabled + spinner）
- 按鈕文字變更為「寄送中...」
- 使用者無法關閉彈窗

---

### Requirement: 寄送成功與失敗回饋
**Priority**: High
**Status**: Proposed

系統 MUST 提供清楚的寄送成功或失敗回饋訊息。

#### Scenario: 單一報價單寄送成功
**Given**: 使用者確認寄送報價單
**When**: API 回傳成功訊息
**Then**:
- 顯示成功 toast 訊息：「報價單已成功寄送至 {customer_email}」
- 關閉寄送確認彈窗
- 該報價單的狀態自動更新為 'sent'
- 列表自動重新整理

#### Scenario: 批次寄送部分成功
**Given**: 使用者批次寄送 5 個報價單
**When**: 其中 3 個成功，2 個失敗
**Then**:
- 顯示警告 toast 訊息：「已成功寄送 3 個報價單，2 個失敗」
- 提供「查看詳細資訊」按鈕
- 點擊後顯示失敗的報價單編號和錯誤原因

#### Scenario: 寄送失敗
**Given**: 使用者確認寄送報價單
**When**: API 回傳錯誤（例如：郵件服務失敗）
**Then**:
- 顯示錯誤 toast 訊息：「寄送失敗：{error_message}」
- 保持寄送確認彈窗開啟
- 允許使用者重試或取消

---

### Requirement: 按鈕樣式與位置
**Priority**: Medium
**Status**: Proposed

系統 SHALL 按照以下規格定義寄送按鈕的外觀和位置。

#### Scenario: 單一報價單寄送按鈕樣式
**Given**: 使用者查看報價單列表
**When**: 顯示操作欄位
**Then**:
- 寄送按鈕文字：「寄送」（中文）或 "Send"（英文）
- 按鈕顏色：綠色（`text-green-700 hover:text-green-900`）
- 按鈕位置：在「編輯」和「檢視」按鈕之間
- disabled 狀態：灰色（`text-gray-400`）且不可點擊

#### Scenario: 批次寄送按鈕樣式
**Given**: 使用者開啟批次操作模式並選擇了報價單
**When**: 顯示批次操作按鈕區
**Then**:
- 批次寄送按鈕文字：「批次寄送 (N)」，N 為選擇數量
- 按鈕顏色：藍綠色（`bg-teal-100 text-teal-700 hover:bg-teal-200`）
- 按鈕位置：在「批次更新狀態」和「批次匯出 PDF」之間

---

## MODIFIED Requirements

無

---

## REMOVED Requirements

無
