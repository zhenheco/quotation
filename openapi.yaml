openapi: 3.1.0

info:
  title: Quotation System API
  description: |
    å ±åƒ¹ç³»çµ± REST API è¦ç¯„æ–‡ä»¶

    ## ç‰¹é»
    - ğŸ” Google OAuth èªè­‰
    - ğŸŒ å¤šèªè¨€æ”¯æ´ (ä¸­æ–‡/è‹±æ–‡)
    - ğŸ’± å¤šå¹£åˆ¥æ”¯æ´
    - ğŸ“„ å®Œæ•´çš„å ±åƒ¹å–®ç®¡ç†
    - ğŸ‘¥ å®¢æˆ¶é—œä¿‚ç®¡ç†
    - ğŸ“¦ ç”¢å“ç›®éŒ„ç®¡ç†
    - ğŸ’° ä»˜æ¬¾è¿½è¹¤
    - ğŸ“Š åˆç´„ç®¡ç†

    ## èªè­‰
    æ‰€æœ‰ API ç«¯é»éƒ½éœ€è¦é€é Supabase Auth é€²è¡Œèªè­‰ã€‚
    è«‹åœ¨è«‹æ±‚æ¨™é ­ä¸­åŒ…å«æœ‰æ•ˆçš„ JWT tokenã€‚

    ## éŒ¯èª¤è™•ç†
    API éµå¾ª RFC 9457 Problem Details æ¨™æº–ã€‚

    ## åˆ†é 
    åˆ—è¡¨ç«¯é»æ”¯æ´å…©ç¨®åˆ†é æ¨¡å¼ï¼š
    - Offset-based: ä½¿ç”¨ `page` å’Œ `pageSize` åƒæ•¸
    - Cursor-based: ä½¿ç”¨ `cursor` å’Œ `limit` åƒæ•¸

  version: 1.0.0
  contact:
    name: API Support
    email: support@quotation-system.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3333/api
    description: Development server
  - url: https://api.quotation-system.com/api
    description: Production server

tags:
  - name: Authentication
    description: ä½¿ç”¨è€…èªè­‰ç›¸é—œæ“ä½œ
  - name: Users
    description: ä½¿ç”¨è€…è³‡æ–™ç®¡ç†
  - name: Customers
    description: å®¢æˆ¶ç®¡ç†
  - name: Products
    description: ç”¢å“ç®¡ç†
  - name: Quotations
    description: å ±åƒ¹å–®ç®¡ç†
  - name: Payments
    description: ä»˜æ¬¾è¨˜éŒ„ç®¡ç†
  - name: Contracts
    description: åˆç´„ç®¡ç†
  - name: Companies
    description: å…¬å¸ç®¡ç†
  - name: Company Settings
    description: å…¬å¸è¨­å®š
  - name: Admin
    description: ç³»çµ±ç®¡ç†å“¡åŠŸèƒ½
  - name: Exchange Rates
    description: åŒ¯ç‡ç®¡ç†

security:
  - BearerAuth: []

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Supabase Auth JWT token

  schemas:
    # ========================================
    # é€šç”¨ Schemas
    # ========================================

    BilingualText:
      type: object
      required:
        - zh
        - en
      properties:
        zh:
          type: string
          description: ä¸­æ–‡æ–‡å­—
          example: "å®¢æˆ¶åç¨±"
        en:
          type: string
          description: è‹±æ–‡æ–‡å­—
          example: "Customer Name"

    Currency:
      type: string
      enum: [TWD, USD, EUR, JPY, CNY]
      example: TWD

    DateString:
      type: string
      format: date-time
      example: "2025-10-20T10:30:00.000Z"

    # æ¨™æº–æˆåŠŸå›æ‡‰
    SuccessResponse:
      type: object
      required:
        - success
        - data
      properties:
        success:
          type: boolean
          enum: [true]
        data:
          type: object
          description: å›æ‡‰è³‡æ–™
        meta:
          $ref: '#/components/schemas/PaginationMeta'
        message:
          type: string
          description: æˆåŠŸè¨Šæ¯
          example: "Operation completed successfully"

    # æ¨™æº–éŒ¯èª¤å›æ‡‰ (RFC 9457)
    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          enum: [false]
        error:
          type: object
          required:
            - type
            - title
            - status
            - detail
          properties:
            type:
              type: string
              description: éŒ¯èª¤é¡å‹æ¨™è­˜ç¬¦
              example: "validation_error"
            title:
              type: string
              description: éŒ¯èª¤æ¨™é¡Œ
              example: "Validation Failed"
            status:
              type: integer
              description: HTTP ç‹€æ…‹ç¢¼
              example: 422
            detail:
              type: string
              description: éŒ¯èª¤è©³ç´°èªªæ˜
              example: "The request contains invalid data"
            instance:
              type: string
              description: ç™¼ç”ŸéŒ¯èª¤çš„ç«¯é»
              example: "/api/customers"
            errors:
              type: array
              description: è©³ç´°çš„é©—è­‰éŒ¯èª¤
              items:
                type: object
                properties:
                  field:
                    type: string
                    example: "email"
                  message:
                    type: string
                    example: "Email format is invalid"
                  code:
                    type: string
                    example: "invalid_email"
        timestamp:
          type: string
          format: date-time
          example: "2025-10-20T10:30:00.000Z"
        requestId:
          type: string
          example: "req_abc123"

    # åˆ†é  Meta
    PaginationMeta:
      type: object
      properties:
        total:
          type: integer
          description: ç¸½è¨˜éŒ„æ•¸
          example: 100
        page:
          type: integer
          description: ç•¶å‰é ç¢¼
          example: 1
        pageSize:
          type: integer
          description: æ¯é æ•¸é‡
          example: 20
        totalPages:
          type: integer
          description: ç¸½é æ•¸
          example: 5
        hasMore:
          type: boolean
          description: æ˜¯å¦æœ‰ä¸‹ä¸€é 
          example: true
        nextCursor:
          type: string
          description: ä¸‹ä¸€é æ¸¸æ¨™ï¼ˆcursor-based åˆ†é ï¼‰
          example: "abc123"

    # ========================================
    # å®¢æˆ¶ Schemas
    # ========================================

    Customer:
      type: object
      required:
        - id
        - user_id
        - name
        - email
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        user_id:
          type: string
          format: uuid
        name:
          $ref: '#/components/schemas/BilingualText'
        email:
          type: string
          format: email
          example: "customer@example.com"
        phone:
          type: string
          example: "+886-912-345-678"
        address:
          $ref: '#/components/schemas/BilingualText'
        tax_id:
          type: string
          example: "12345678"
        contact_person:
          $ref: '#/components/schemas/BilingualText'
        created_at:
          $ref: '#/components/schemas/DateString'
        updated_at:
          $ref: '#/components/schemas/DateString'

    CreateCustomerInput:
      type: object
      required:
        - name
        - email
      properties:
        name:
          $ref: '#/components/schemas/BilingualText'
        email:
          type: string
          format: email
        phone:
          type: string
        address:
          $ref: '#/components/schemas/BilingualText'
        tax_id:
          type: string
        contact_person:
          $ref: '#/components/schemas/BilingualText'

    UpdateCustomerInput:
      type: object
      properties:
        name:
          $ref: '#/components/schemas/BilingualText'
        email:
          type: string
          format: email
        phone:
          type: string
        address:
          $ref: '#/components/schemas/BilingualText'
        tax_id:
          type: string
        contact_person:
          $ref: '#/components/schemas/BilingualText'

    # ========================================
    # ç”¢å“ Schemas
    # ========================================

    Product:
      type: object
      required:
        - id
        - user_id
        - name
        - unit_price
        - currency
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        sku:
          type: string
          example: "PRD-001"
        name:
          $ref: '#/components/schemas/BilingualText'
        description:
          $ref: '#/components/schemas/BilingualText'
        unit_price:
          type: number
          format: double
          minimum: 0
          example: 1000.00
        currency:
          $ref: '#/components/schemas/Currency'
        category:
          type: string
          example: "é›»å­ç”¢å“"
        cost_price:
          type: number
          format: double
          description: æˆæœ¬åƒ¹
        supplier:
          type: string
          description: ä¾›æ‡‰å•†
        created_at:
          $ref: '#/components/schemas/DateString'
        updated_at:
          $ref: '#/components/schemas/DateString'

    CreateProductInput:
      type: object
      required:
        - name
        - unit_price
        - currency
      properties:
        sku:
          type: string
        name:
          $ref: '#/components/schemas/BilingualText'
        description:
          $ref: '#/components/schemas/BilingualText'
        unit_price:
          type: number
          format: double
          minimum: 0
        currency:
          $ref: '#/components/schemas/Currency'
        category:
          type: string
        cost_price:
          type: number
          format: double
        supplier:
          type: string

    # ========================================
    # å ±åƒ¹å–® Schemas
    # ========================================

    Quotation:
      type: object
      required:
        - id
        - user_id
        - customer_id
        - quotation_number
        - status
        - issue_date
        - valid_until
        - currency
        - subtotal
        - tax_rate
        - tax_amount
        - total_amount
        - created_at
        - updated_at
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        customer_id:
          type: string
          format: uuid
        quotation_number:
          type: string
          example: "Q2025-001"
        status:
          type: string
          enum: [draft, sent, accepted, rejected]
        issue_date:
          type: string
          format: date
          example: "2025-10-20"
        valid_until:
          type: string
          format: date
          example: "2025-11-20"
        currency:
          $ref: '#/components/schemas/Currency'
        subtotal:
          type: number
          format: double
          example: 10000.00
        tax_rate:
          type: number
          format: double
          minimum: 0
          maximum: 100
          example: 5.0
        tax_amount:
          type: number
          format: double
          example: 500.00
        total_amount:
          type: number
          format: double
          example: 10500.00
        notes:
          type: string
        created_at:
          $ref: '#/components/schemas/DateString'
        updated_at:
          $ref: '#/components/schemas/DateString'

    QuotationItem:
      type: object
      required:
        - id
        - quotation_id
        - quantity
        - unit_price
        - discount
        - subtotal
      properties:
        id:
          type: string
          format: uuid
        quotation_id:
          type: string
          format: uuid
        product_id:
          type: string
          format: uuid
        quantity:
          type: number
          format: double
          minimum: 0
          example: 10
        unit_price:
          type: number
          format: double
          minimum: 0
          example: 1000.00
        discount:
          type: number
          format: double
          minimum: 0
          maximum: 100
          example: 10.0
        subtotal:
          type: number
          format: double
          example: 9000.00
        created_at:
          $ref: '#/components/schemas/DateString'
        updated_at:
          $ref: '#/components/schemas/DateString'

    CreateQuotationInput:
      type: object
      required:
        - customer_id
        - issue_date
        - valid_until
        - currency
        - subtotal
        - tax_rate
        - tax_amount
        - total_amount
        - items
      properties:
        customer_id:
          type: string
          format: uuid
        issue_date:
          type: string
          format: date
        valid_until:
          type: string
          format: date
        currency:
          $ref: '#/components/schemas/Currency'
        subtotal:
          type: number
          format: double
        tax_rate:
          type: number
          format: double
        tax_amount:
          type: number
          format: double
        total_amount:
          type: number
          format: double
        notes:
          type: string
        items:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - quantity
              - unit_price
              - subtotal
            properties:
              product_id:
                type: string
                format: uuid
              quantity:
                type: number
                format: double
              unit_price:
                type: number
                format: double
              discount:
                type: number
                format: double
                default: 0
              subtotal:
                type: number
                format: double

    # ========================================
    # ä»˜æ¬¾ Schemas
    # ========================================

    Payment:
      type: object
      required:
        - id
        - user_id
        - customer_id
        - payment_type
        - payment_date
        - amount
        - currency
        - status
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        customer_id:
          type: string
          format: uuid
        quotation_id:
          type: string
          format: uuid
        contract_id:
          type: string
          format: uuid
        payment_type:
          type: string
          enum: [deposit, installment, final, full, recurring]
        payment_date:
          type: string
          format: date
        amount:
          type: number
          format: double
        currency:
          $ref: '#/components/schemas/Currency'
        payment_frequency:
          type: string
          enum: [monthly, quarterly, semi_annual, annual]
        is_overdue:
          type: boolean
          default: false
        days_overdue:
          type: integer
          default: 0
        payment_method:
          type: string
          enum: [bank_transfer, credit_card, check, cash, other]
        reference_number:
          type: string
        receipt_url:
          type: string
          format: uri
        status:
          type: string
          enum: [pending, confirmed, cancelled]
        notes:
          type: string
        created_at:
          $ref: '#/components/schemas/DateString'
        updated_at:
          $ref: '#/components/schemas/DateString'

    CreatePaymentInput:
      type: object
      required:
        - customer_id
        - payment_type
        - payment_date
        - amount
        - currency
      properties:
        customer_id:
          type: string
          format: uuid
        quotation_id:
          type: string
          format: uuid
        contract_id:
          type: string
          format: uuid
        payment_type:
          type: string
          enum: [deposit, installment, final, full, recurring]
        payment_date:
          type: string
          format: date
        amount:
          type: number
          format: double
        currency:
          $ref: '#/components/schemas/Currency'
        payment_method:
          type: string
          enum: [bank_transfer, credit_card, check, cash, other]
        reference_number:
          type: string
        notes:
          type: string

    # ========================================
    # åˆç´„ Schemas
    # ========================================

    Contract:
      type: object
      required:
        - id
        - user_id
        - customer_id
        - contract_number
        - title
        - start_date
        - end_date
        - status
        - total_amount
        - currency
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        customer_id:
          type: string
          format: uuid
        quotation_id:
          type: string
          format: uuid
        contract_number:
          type: string
          example: "C2025-001"
        title:
          type: string
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        signed_date:
          type: string
          format: date
        status:
          type: string
          enum: [draft, active, expired, terminated]
        total_amount:
          type: number
          format: double
        currency:
          $ref: '#/components/schemas/Currency'
        payment_terms:
          type: string
          enum: [monthly, quarterly, semi_annual, annual]
        next_collection_date:
          type: string
          format: date
        next_collection_amount:
          type: number
          format: double
        contract_file_url:
          type: string
          format: uri
        notes:
          type: string
        terms_and_conditions:
          type: string
        created_at:
          $ref: '#/components/schemas/DateString'
        updated_at:
          $ref: '#/components/schemas/DateString'

  parameters:
    # åˆ†é åƒæ•¸
    PageParam:
      name: page
      in: query
      description: é ç¢¼ï¼ˆå¾ 1 é–‹å§‹ï¼‰
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
        example: 1

    PageSizeParam:
      name: pageSize
      in: query
      description: æ¯é æ•¸é‡ï¼ˆæœ€å¤§ 100ï¼‰
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
        example: 20

    CursorParam:
      name: cursor
      in: query
      description: æ¸¸æ¨™ï¼ˆç”¨æ–¼ cursor-based åˆ†é ï¼‰
      required: false
      schema:
        type: string
        example: "abc123"

    LimitParam:
      name: limit
      in: query
      description: è¿”å›æ•¸é‡é™åˆ¶
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
        example: 20

    # æ’åºåƒæ•¸
    SortParam:
      name: sort
      in: query
      description: æ’åºæ¬„ä½ï¼ˆå‰ç¶´ `-` è¡¨ç¤ºé™åºï¼‰
      required: false
      schema:
        type: string
        example: "-created_at"

    # æœå°‹åƒæ•¸
    SearchParam:
      name: q
      in: query
      description: æœå°‹é—œéµå­—
      required: false
      schema:
        type: string
        example: "å®¢æˆ¶åç¨±"

    # è·¯å¾‘åƒæ•¸
    IdParam:
      name: id
      in: path
      description: è³‡æº ID
      required: true
      schema:
        type: string
        format: uuid
        example: "550e8400-e29b-41d4-a716-446655440000"

  responses:
    Unauthorized:
      description: æœªèªè­‰
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              type: "unauthorized"
              title: "Authentication Required"
              status: 401
              detail: "You must be authenticated to access this resource"
            timestamp: "2025-10-20T10:30:00.000Z"

    Forbidden:
      description: ç„¡æ¬Šé™
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              type: "forbidden"
              title: "Access Denied"
              status: 403
              detail: "You don't have permission to perform this action"
            timestamp: "2025-10-20T10:30:00.000Z"

    NotFound:
      description: è³‡æºä¸å­˜åœ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              type: "not_found"
              title: "Resource Not Found"
              status: 404
              detail: "The requested resource was not found"
            timestamp: "2025-10-20T10:30:00.000Z"

    ValidationError:
      description: é©—è­‰å¤±æ•—
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              type: "validation_error"
              title: "Validation Failed"
              status: 422
              detail: "The request contains invalid data"
              errors:
                - field: "email"
                  message: "Email format is invalid"
                  code: "invalid_email"
                - field: "name.zh"
                  message: "Chinese name is required"
                  code: "required"
            timestamp: "2025-10-20T10:30:00.000Z"

    RateLimitExceeded:
      description: è¶…éé€Ÿç‡é™åˆ¶
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              type: "rate_limit_exceeded"
              title: "Too Many Requests"
              status: 429
              detail: "Rate limit exceeded. Please retry after 60 seconds"
            timestamp: "2025-10-20T10:30:00.000Z"
      headers:
        X-RateLimit-Limit:
          description: é€Ÿç‡é™åˆ¶ä¸Šé™
          schema:
            type: integer
        X-RateLimit-Remaining:
          description: å‰©é¤˜è«‹æ±‚æ¬¡æ•¸
          schema:
            type: integer
        X-RateLimit-Reset:
          description: é™åˆ¶é‡ç½®æ™‚é–“
          schema:
            type: string
            format: date-time
        Retry-After:
          description: å»ºè­°é‡è©¦ç­‰å¾…ç§’æ•¸
          schema:
            type: integer

    InternalServerError:
      description: ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              type: "internal_error"
              title: "Internal Server Error"
              status: 500
              detail: "An unexpected error occurred"
            timestamp: "2025-10-20T10:30:00.000Z"

# ========================================
# API ç«¯é»å®šç¾©
# ========================================

paths:
  # ========================================
  # èªè­‰ API
  # ========================================

  /me:
    get:
      tags:
        - Users
      summary: å–å¾—ç•¶å‰ä½¿ç”¨è€…è³‡è¨Š
      description: ç²å–å·²èªè­‰ä½¿ç”¨è€…çš„å€‹äººè³‡æ–™
      operationId: getCurrentUser
      security:
        - BearerAuth: []
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      email:
                        type: string
                        format: email
                      name:
                        type: string
                      avatar_url:
                        type: string
                        format: uri
                      created_at:
                        $ref: '#/components/schemas/DateString'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ========================================
  # å®¢æˆ¶ API
  # ========================================

  /customers:
    get:
      tags:
        - Customers
      summary: åˆ—å‡ºæ‰€æœ‰å®¢æˆ¶
      description: ç²å–ç•¶å‰ä½¿ç”¨è€…çš„æ‰€æœ‰å®¢æˆ¶åˆ—è¡¨
      operationId: listCustomers
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/SearchParam'
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Customer'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

    post:
      tags:
        - Customers
      summary: å‰µå»ºæ–°å®¢æˆ¶
      description: å‰µå»ºä¸€å€‹æ–°çš„å®¢æˆ¶è¨˜éŒ„
      operationId: createCustomer
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCustomerInput'
            examples:
              basic:
                summary: åŸºæœ¬å®¢æˆ¶è³‡è¨Š
                value:
                  name:
                    zh: "å°ç£ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸"
                    en: "Taiwan Tech Co., Ltd."
                  email: "contact@taiwantech.com"
                  phone: "+886-2-1234-5678"
              full:
                summary: å®Œæ•´å®¢æˆ¶è³‡è¨Š
                value:
                  name:
                    zh: "å°ç£ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸"
                    en: "Taiwan Tech Co., Ltd."
                  email: "contact@taiwantech.com"
                  phone: "+886-2-1234-5678"
                  address:
                    zh: "å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿ"
                    en: "No. 7, Sec. 5, Xinyi Rd., Xinyi Dist., Taipei City"
                  tax_id: "12345678"
                  contact_person:
                    zh: "ç‹å¤§æ˜"
                    en: "David Wang"
      responses:
        '201':
          description: å‰µå»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    $ref: '#/components/schemas/Customer'
                  message:
                    type: string
                    example: "Customer created successfully"
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

  /customers/{id}:
    get:
      tags:
        - Customers
      summary: å–å¾—å®¢æˆ¶è©³æƒ…
      description: æ ¹æ“š ID ç²å–ç‰¹å®šå®¢æˆ¶çš„è©³ç´°è³‡è¨Š
      operationId: getCustomer
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    $ref: '#/components/schemas/Customer'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags:
        - Customers
      summary: æ›´æ–°å®¢æˆ¶è³‡è¨Š
      description: æ›´æ–°æŒ‡å®šå®¢æˆ¶çš„è³‡è¨Š
      operationId: updateCustomer
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCustomerInput'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    $ref: '#/components/schemas/Customer'
                  message:
                    type: string
                    example: "Customer updated successfully"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

    delete:
      tags:
        - Customers
      summary: åˆªé™¤å®¢æˆ¶
      description: åˆªé™¤æŒ‡å®šçš„å®¢æˆ¶è¨˜éŒ„
      operationId: deleteCustomer
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: åˆªé™¤æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  message:
                    type: string
                    example: "Customer deleted successfully"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ========================================
  # ç”¢å“ API
  # ========================================

  /products:
    get:
      tags:
        - Products
      summary: åˆ—å‡ºæ‰€æœ‰ç”¢å“
      description: ç²å–ç•¶å‰ä½¿ç”¨è€…çš„æ‰€æœ‰ç”¢å“åˆ—è¡¨
      operationId: listProducts
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
        - $ref: '#/components/parameters/SortParam'
        - $ref: '#/components/parameters/SearchParam'
        - name: category
          in: query
          description: ç”¢å“é¡åˆ¥éæ¿¾
          required: false
          schema:
            type: string
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Product'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'

    post:
      tags:
        - Products
      summary: å‰µå»ºæ–°ç”¢å“
      description: å‰µå»ºä¸€å€‹æ–°çš„ç”¢å“è¨˜éŒ„
      operationId: createProduct
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductInput'
            examples:
              basic:
                summary: åŸºæœ¬ç”¢å“
                value:
                  name:
                    zh: "ç­†è¨˜å‹é›»è…¦"
                    en: "Laptop"
                  unit_price: 30000
                  currency: "TWD"
              full:
                summary: å®Œæ•´ç”¢å“è³‡è¨Š
                value:
                  sku: "PRD-001"
                  name:
                    zh: "ç­†è¨˜å‹é›»è…¦"
                    en: "Laptop"
                  description:
                    zh: "é«˜æ•ˆèƒ½å•†å‹™ç­†è¨˜å‹é›»è…¦"
                    en: "High-performance business laptop"
                  unit_price: 30000
                  currency: "TWD"
                  category: "é›»å­ç”¢å“"
                  cost_price: 20000
                  supplier: "æŸæŸç§‘æŠ€"
      responses:
        '201':
          description: å‰µå»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    $ref: '#/components/schemas/Product'
                  message:
                    type: string
                    example: "Product created successfully"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /products/{id}:
    get:
      tags:
        - Products
      summary: å–å¾—ç”¢å“è©³æƒ…
      operationId: getProduct
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    $ref: '#/components/schemas/Product'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags:
        - Products
      summary: æ›´æ–°ç”¢å“è³‡è¨Š
      operationId: updateProduct
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductInput'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    $ref: '#/components/schemas/Product'
                  message:
                    type: string
                    example: "Product updated successfully"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Products
      summary: åˆªé™¤ç”¢å“
      operationId: deleteProduct
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: åˆªé™¤æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  message:
                    type: string
                    example: "Product deleted successfully"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ========================================
  # å ±åƒ¹å–® API
  # ========================================

  /quotations:
    post:
      tags:
        - Quotations
      summary: å‰µå»ºæ–°å ±åƒ¹å–®
      description: å‰µå»ºä¸€å€‹æ–°çš„å ±åƒ¹å–®
      operationId: createQuotation
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateQuotationInput'
            example:
              customer_id: "550e8400-e29b-41d4-a716-446655440000"
              issue_date: "2025-10-20"
              valid_until: "2025-11-20"
              currency: "TWD"
              subtotal: 10000
              tax_rate: 5
              tax_amount: 500
              total_amount: 10500
              notes: "æ„Ÿè¬æ‚¨çš„è©¢åƒ¹"
              items:
                - product_id: "660e8400-e29b-41d4-a716-446655440001"
                  quantity: 10
                  unit_price: 1000
                  discount: 0
                  subtotal: 10000
      responses:
        '201':
          description: å‰µå»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    $ref: '#/components/schemas/Quotation'
                  message:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /quotations/{id}:
    put:
      tags:
        - Quotations
      summary: æ›´æ–°å ±åƒ¹å–®
      operationId: updateQuotation
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateQuotationInput'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    $ref: '#/components/schemas/Quotation'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Quotations
      summary: åˆªé™¤å ±åƒ¹å–®
      operationId: deleteQuotation
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: åˆªé™¤æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  message:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # ========================================
  # ä»˜æ¬¾ API
  # ========================================

  /payments:
    get:
      tags:
        - Payments
      summary: åˆ—å‡ºä»˜æ¬¾è¨˜éŒ„
      description: ç²å–ä»˜æ¬¾è¨˜éŒ„åˆ—è¡¨
      operationId: listPayments
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
        - name: customer_id
          in: query
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, confirmed, cancelled]
        - name: payment_type
          in: query
          schema:
            type: string
            enum: [deposit, installment, final, full, recurring]
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Payment'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Payments
      summary: è¨˜éŒ„æ–°ä»˜æ¬¾
      description: è¨˜éŒ„ä¸€ç­†æ–°çš„ä»˜æ¬¾è¨˜éŒ„
      operationId: createPayment
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePaymentInput'
            example:
              customer_id: "550e8400-e29b-41d4-a716-446655440000"
              quotation_id: "660e8400-e29b-41d4-a716-446655440001"
              payment_type: "deposit"
              payment_date: "2025-10-20"
              amount: 5000
              currency: "TWD"
              payment_method: "bank_transfer"
              reference_number: "TXN123456"
      responses:
        '201':
          description: è¨˜éŒ„æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    $ref: '#/components/schemas/Payment'
                  message:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /payments/unpaid:
    get:
      tags:
        - Payments
      summary: åˆ—å‡ºæœªæ”¶æ¬¾è¨˜éŒ„
      description: ç²å–æ‰€æœ‰æœªæ”¶æ¬¾çš„è¨˜éŒ„
      operationId: listUnpaidPayments
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    type: array
                    items:
                      type: object
        '401':
          $ref: '#/components/responses/Unauthorized'

  /payments/collected:
    get:
      tags:
        - Payments
      summary: åˆ—å‡ºå·²æ”¶æ¬¾è¨˜éŒ„
      description: ç²å–æ‰€æœ‰å·²æ”¶æ¬¾çš„è¨˜éŒ„
      operationId: listCollectedPayments
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PageSizeParam'
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Payment'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ========================================
  # åŒ¯ç‡ API
  # ========================================

  /exchange-rates:
    get:
      tags:
        - Exchange Rates
      summary: å–å¾—åŒ¯ç‡è³‡æ–™
      description: ç²å–æœ€æ–°æˆ–æŒ‡å®šæ—¥æœŸçš„åŒ¯ç‡è³‡æ–™
      operationId: getExchangeRates
      security:
        - BearerAuth: []
      parameters:
        - name: date
          in: query
          description: æŸ¥è©¢æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  data:
                    type: object
                    additionalProperties:
                      type: number
                      format: double
                    example:
                      USD: 31.5
                      EUR: 34.2
                      JPY: 0.21
                      CNY: 4.35
        '401':
          $ref: '#/components/responses/Unauthorized'

  /exchange-rates/sync:
    post:
      tags:
        - Exchange Rates
      summary: åŒæ­¥åŒ¯ç‡è³‡æ–™
      description: å¾å¤–éƒ¨ API åŒæ­¥æœ€æ–°åŒ¯ç‡è³‡æ–™
      operationId: syncExchangeRates
      security:
        - BearerAuth: []
      responses:
        '200':
          description: åŒæ­¥æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    enum: [true]
                  message:
                    type: string
                    example: "Exchange rates synced successfully"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimitExceeded'
        '500':
          $ref: '#/components/responses/InternalServerError'
