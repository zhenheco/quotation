# 會計系統功能擴充規格

## 任務描述

擴充現有會計系統功能，包括：發票多元輸入方式、傳票自動分錄、報表分析功能，以及營業稅申報書產出。

---

## 功能需求

### 1. 發票新增方式擴充

目前發票只能手動輸入，需要增加以下兩種輸入方式：

#### 1.1 Excel 批次上傳
- 提供標準 Excel 範本供下載
- 支援 .xlsx 格式
- 必填欄位：發票號碼、類型、日期、未稅金額、稅額、含稅金額
- 驗證後顯示預覽畫面，用戶確認後批次匯入

#### 1.2 AI 掃描輸入（Qwen VL2.5）
- 使用 AI 視覺模型掃描發票圖片
- 支援 JPG、PNG、PDF 格式
- 顯示辨識結果供用戶確認/修正
- 信心度低的欄位以黃色標示

#### 1.3 手動輸入
維持目前的手動輸入功能。

---

### 2. 傳票自動分錄

發票過帳時自動產生對應的會計分錄。

銷項發票：
- 借：應收帳款（1141）[含稅金額]
- 貸：銷貨收入（4111）[未稅金額]
- 貸：銷項稅額（2171）[稅額]

進項發票：
- 借：進貨成本（5111）[未稅金額]
- 借：進項稅額（1181）[稅額]
- 貸：應付帳款（2141）[含稅金額]

---

### 3. 報表分析功能

#### 3.1 試算表分析
- 借貸平衡檢查
- 異常科目警示
- 期間比較
- 趨勢圖表

#### 3.2 損益表分析
- 毛利率、營業利益率、淨利率
- 費用結構分析
- 期間比較與趨勢圖表

#### 3.3 資產負債表分析
- 流動比率、速動比率、負債比率
- ROA、ROE
- 結構分析圓餅圖

---

### 4. 營業稅申報書（401/403）

#### 4.1 401 申報書
自動彙總發票資料，產出 PDF 和 XML 格式。

#### 4.2 403 申報書
處理零稅率銷售的特殊申報。

---

## 注意事項

- Qwen VL2.5 API Key 需存放在 .env
- 使用 exceljs 套件處理 Excel
- 營業稅 XML 需符合國稅局規範
- 預設稅率 5%，支援零稅率與免稅

---

## 完成條件

- [ ] Excel 範本已建立並可下載
- [ ] Excel 上傳功能完成
- [ ] AI 掃描功能完成
- [ ] 三種輸入方式整合為 Tab 介面
- [ ] 傳票自動分錄功能完成
- [ ] 報表分析功能完成（三表）
- [ ] 401/403 申報書功能完成
- [ ] 通過 lint 和 typecheck
- [ ] i18n 翻譯完整
