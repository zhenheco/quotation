# ç§»é™¤å¤šèªç³»ï¼Œæ”¹ç‚ºç´”ç¹é«”ä¸­æ–‡

> å»ºç«‹æ—¥æœŸï¼š2026-01-04
> ç‹€æ…‹ï¼šğŸ”´ å¾…å¯¦ä½œ

## ğŸ“‹ éœ€æ±‚æ‘˜è¦

å°‡å°ˆæ¡ˆå¾ next-intl å¤šèªç³»æ¶æ§‹ï¼ˆen/zhï¼‰æ”¹ç‚ºç´”ç¹é«”ä¸­æ–‡ã€‚

**èƒŒæ™¯**ï¼š
- æ­¤ç³»çµ±çš„ç¨…å‹™å…§å®¹å°ˆå±¬å°ç£å¸‚å ´
- ä¸»è¦ç”¨æˆ¶ç‚ºå°ç£å…¬å¸
- ç°¡åŒ–ç¶­è­·ï¼Œç§»é™¤ä¸å¿…è¦çš„å¤šèªç³»è¤‡é›œåº¦

**ç”¨æˆ¶æ±ºç­–**ï¼š
- âœ… ç¡¬ç·¨ç¢¼ä¸­æ–‡å­—ä¸²ï¼ˆå®Œå…¨ç§»é™¤ next-intlï¼‰
- âœ… è¨­å®š 301 é‡å®šå‘ï¼ˆ/zh/* â†’ /*ï¼‰
- âœ… ä¸€æ¬¡å®Œæˆæ‰€æœ‰è®Šæ›´

---

## ğŸ“Š å½±éŸ¿ç¯„åœçµ±è¨ˆ

| é …ç›® | æ•¸é‡ |
|------|------|
| ä½¿ç”¨ `useTranslations()` çš„æª”æ¡ˆ | 93 å€‹ |
| ä½¿ç”¨ `getTranslations()` çš„æª”æ¡ˆ | 30 å€‹ |
| Layout æª”æ¡ˆï¼ˆæ¥æ”¶ locale åƒæ•¸ï¼‰ | 11 å€‹ |
| éœ€è¦é·ç§»çš„é é¢/çµ„ä»¶ | ~99 å€‹ |
| ç¿»è­¯æª”æ¡ˆå¤§å° | zh.json 75KB, 1929 è¡Œ |

---

## ğŸ¯ é©—æ”¶æ¨™æº–ï¼ˆAcceptance Criteriaï¼‰

- [ ] AC1: æ‰€æœ‰é é¢ URL ä¸å†æœ‰ `/zh/` æˆ– `/en/` å‰ç¶´
- [ ] AC2: èˆŠé€£çµ `/zh/*` è‡ªå‹• 301 é‡å®šå‘åˆ° `/*`
- [ ] AC3: æ‰€æœ‰ UI æ–‡å­—é¡¯ç¤ºç¹é«”ä¸­æ–‡
- [ ] AC4: `pnpm run build` æˆåŠŸ
- [ ] AC5: `pnpm run typecheck` ç„¡éŒ¯èª¤
- [ ] AC6: ç™»å…¥/ç™»å‡ºæµç¨‹æ­£å¸¸
- [ ] AC7: æ‰€æœ‰å°è¦½é€£çµæ­£ç¢ºé‹ä½œ

---

## ğŸ—‚ï¸ å½±éŸ¿ç¯„åœ

### åˆªé™¤æª”æ¡ˆ
- `i18n/request.ts` - i18n è«‹æ±‚é…ç½®
- `i18n/routing.ts` - i18n è·¯ç”±é…ç½®
- `messages/en.json` - è‹±æ–‡ç¿»è­¯
- `messages/zh.json` - ä¸­æ–‡ç¿»è­¯ï¼ˆæœ€å¾Œåˆªé™¤ï¼‰
- `app/[locale]/` - æ•´å€‹ç›®éŒ„ï¼ˆç§»å‹•å¾Œåˆªé™¤ï¼‰

### ä¿®æ”¹æª”æ¡ˆ

**é…ç½®æª”æ¡ˆ**
- `next.config.ts` - ç§»é™¤ next-intl æ’ä»¶ï¼Œæ·»åŠ  301 é‡å®šå‘
- `middleware.ts` - ç§»é™¤ i18n ä¸­é–“ä»¶

**Layout æª”æ¡ˆï¼ˆ11 å€‹ï¼‰**
- `app/layout.tsx` - åˆä½µ locale layoutï¼Œæ·»åŠ  Providers
- `app/dashboard/layout.tsx` - ç§»é™¤ locale åƒæ•¸
- `app/accounting/layout.tsx` - ç§»é™¤ locale åƒæ•¸
- `app/customers/layout.tsx` - ç§»é™¤ locale åƒæ•¸
- `app/products/layout.tsx` - ç§»é™¤ locale åƒæ•¸
- `app/quotations/layout.tsx` - ç§»é™¤ locale åƒæ•¸
- `app/suppliers/layout.tsx` - ç§»é™¤ locale åƒæ•¸
- `app/payments/layout.tsx` - ç§»é™¤ locale åƒæ•¸
- `app/contracts/layout.tsx` - ç§»é™¤ locale åƒæ•¸
- `app/settings/layout.tsx` - ç§»é™¤ locale åƒæ•¸
- `app/help/layout.tsx` - ç§»é™¤ locale åƒæ•¸

**æ ¸å¿ƒçµ„ä»¶**
- `components/Sidebar.tsx` - ç§»é™¤ locale åƒæ•¸ï¼Œç¡¬ç·¨ç¢¼ä¸­æ–‡
- `components/Header.tsx` - ç§»é™¤èªè¨€åˆ‡æ›å™¨ï¼Œç§»é™¤ locale åƒæ•¸
- `components/MobileNav.tsx` - ç§»é™¤ locale åƒæ•¸

**æ‰€æœ‰ä½¿ç”¨ç¿»è­¯çš„é é¢å’Œçµ„ä»¶ï¼ˆ~90 å€‹ï¼‰**
- ç§»é™¤ `useTranslations()` / `getTranslations()` import
- æ›¿æ› `t('key')` ç‚ºç¡¬ç·¨ç¢¼ä¸­æ–‡å­—ä¸²
- ç§»é™¤ locale åƒæ•¸

### ç›¸ä¾æ¨¡çµ„
- `next-intl` - ç§»é™¤æ­¤ä¾è³´

---

## ğŸ§ª æ¸¬è©¦è¨ˆåŠƒ

| æ¸¬è©¦æ¡ˆä¾‹ | å°æ‡‰ AC | é¡å‹ | å„ªå…ˆé †åº |
|---------|--------|------|---------|
| è¨ªå• /dashboard æ‡‰é¡¯ç¤ºå„€è¡¨æ¿ | AC1 | E2E | ğŸ”´ é«˜ |
| è¨ªå• /zh/dashboard æ‡‰ 301 é‡å®šå‘åˆ° /dashboard | AC2 | E2E | ğŸ”´ é«˜ |
| æ‰€æœ‰é é¢æ‡‰é¡¯ç¤ºç¹é«”ä¸­æ–‡ | AC3 | E2E | ğŸ”´ é«˜ |
| pnpm run build æˆåŠŸ | AC4 | Build | ğŸ”´ é«˜ |
| pnpm run typecheck ç„¡éŒ¯èª¤ | AC5 | Build | ğŸ”´ é«˜ |
| ç™»å…¥æµç¨‹æ­£å¸¸é‹ä½œ | AC6 | E2E | ğŸ”´ é«˜ |
| å´é‚Šæ¬„å°è¦½é€£çµæ­£ç¢º | AC7 | E2E | ğŸŸ¡ ä¸­ |

---

## ğŸ“ TDD å¯¦ä½œæ­¥é©Ÿ

### Phase 1: é…ç½®ä¿®æ”¹

1. ğŸ”´ **Red - ç¢ºèªç¾ç‹€**
   - ç¢ºèª build å’Œ typecheck é€šé
   - è¨˜éŒ„ç¾æœ‰åŠŸèƒ½ç‹€æ…‹

2. ğŸŸ¢ **Green - ä¿®æ”¹é…ç½®**
   - ä¿®æ”¹ `next.config.ts`ï¼š
     - ç§»é™¤ `createNextIntlPlugin` å°å…¥
     - ç§»é™¤ `withNextIntl` åŒ…è£
     - æ·»åŠ  301 é‡å®šå‘è¦å‰‡
   - ä¿®æ”¹ `middleware.ts`ï¼š
     - ç§»é™¤ `createMiddleware from 'next-intl/middleware'`
     - ç§»é™¤ `routing from '@/i18n/routing'`
     - ç§»é™¤ `intlMiddleware` ç›¸é—œé‚è¼¯
     - ä¿ç•™ï¼šSupabase authã€é€Ÿç‡é™åˆ¶ã€å®‰å…¨æ¨™é ­

3. ğŸ”µ **Refactor**
   - ç°¡åŒ– middleware é‚è¼¯

### Phase 2: è·¯ç”±çµæ§‹é·ç§»

1. ğŸ”´ **Red - æº–å‚™é·ç§»**
   - ç¢ºèª `app/[locale]/` ä¸‹æ‰€æœ‰å…§å®¹

2. ğŸŸ¢ **Green - ç§»å‹•ç›®éŒ„**
   - å°‡ `app/[locale]/*` ç§»å‹•åˆ° `app/*`
   - æ›´æ–°æ ¹ `app/layout.tsx`ï¼š
     - åˆä½µ locale layout
     - æ·»åŠ  `Providers`
     - è¨­å®š `<html lang="zh-TW">`
   - åˆªé™¤ `app/[locale]/` ç›®éŒ„

3. ğŸ”µ **Refactor**
   - ç§»é™¤å†—é¤˜æª”æ¡ˆ

### Phase 3: çµ„ä»¶æ›´æ–°ï¼ˆæŒ‰å„ªå…ˆé †åºï¼‰

1. ğŸ”´ **Red - æ ¸å¿ƒçµ„ä»¶**
   - è™•ç† `Sidebar.tsx`, `Header.tsx`, `MobileNav.tsx`

2. ğŸŸ¢ **Green - æ›´æ–°çµ„ä»¶**
   - ç§»é™¤ locale åƒæ•¸
   - ç¡¬ç·¨ç¢¼ä¸­æ–‡å­—ä¸²
   - æ›´æ–°é€£çµï¼ˆç§»é™¤ `/${locale}` å‰ç¶´ï¼‰

3. ğŸ”µ **Refactor**
   - çµ±ä¸€å‘½åé¢¨æ ¼

### Phase 4: é é¢æ›´æ–°

1. ğŸ”´ **Red - å„ªå…ˆé é¢**
   - Dashboard, Login, Quotations ç­‰æ ¸å¿ƒé é¢

2. ğŸŸ¢ **Green - æ‰¹é‡æ›´æ–°**
   - ç§»é™¤æ‰€æœ‰ `useTranslations()` / `getTranslations()` import
   - æ›¿æ› `t('key')` ç‚ºç¡¬ç·¨ç¢¼ä¸­æ–‡ï¼ˆåƒè€ƒ zh.jsonï¼‰
   - ç§»é™¤ locale åƒæ•¸
   - æ›´æ–°é€£çµè·¯å¾‘

3. ğŸ”µ **Refactor**
   - ç¢ºä¿ç¨‹å¼ç¢¼é¢¨æ ¼ä¸€è‡´

### Phase 5: æ¸…ç†

1. ğŸ”´ **Red - ç¢ºèªç„¡éºæ¼**
   - grep æœå°‹æ‰€æœ‰ `next-intl` å¼•ç”¨
   - ç¢ºèªç„¡éºæ¼çš„ `t(` èª¿ç”¨

2. ğŸŸ¢ **Green - åˆªé™¤æª”æ¡ˆ**
   - åˆªé™¤ `i18n/` ç›®éŒ„
   - åˆªé™¤ `messages/` ç›®éŒ„
   - ç§»é™¤ `next-intl` ä¾è³´ï¼š`pnpm remove next-intl`

3. ğŸ”µ **Refactor**
   - æœ€çµ‚æ¸…ç†

### Phase 6: é©—è­‰

1. åŸ·è¡Œ `pnpm run build`
2. åŸ·è¡Œ `pnpm run typecheck`
3. åŸ·è¡Œ `pnpm run lint`
4. æ‰‹å‹•æ¸¬è©¦æ ¸å¿ƒåŠŸèƒ½

---

## âš ï¸ æŠ€è¡“é¢¨éšªèˆ‡å°ç­–

| é¢¨éšª | å½±éŸ¿ç¨‹åº¦ | å°ç­– |
|-----|---------|-----|
| Auth æµç¨‹ä¸­æ–· | ğŸ”´ é«˜ | ç¢ºèª OAuth å›èª¿ URL æ›´æ–°ï¼Œåˆ†æ­¥æ¸¬è©¦ |
| Middleware æ”¹å‹•ç ´å£èªè­‰ | ğŸ”´ é«˜ | åˆ†æ­¥é©Ÿä¿®æ”¹ï¼Œå…ˆä¿ç•™ auth é‚è¼¯ |
| éºæ¼ç¿»è­¯æ›¿æ› | ğŸŸ¡ ä¸­ | ä½¿ç”¨ grep æœå°‹æ‰€æœ‰ `t(` èª¿ç”¨ |
| èˆŠé€£çµå¤±æ•ˆ | ğŸŸ¡ ä¸­ | 301 é‡å®šå‘ç¢ºä¿ç›¸å®¹ |
| å¤§é‡æª”æ¡ˆä¿®æ”¹æ˜“å‡ºéŒ¯ | ğŸŸ¡ ä¸­ | åˆ†æ¨¡çµ„è™•ç†ï¼Œæ¯éšæ®µæ¸¬è©¦ |

---

## ğŸ“Š é æœŸæ¸¬è©¦è¦†è“‹ç‡

ç”±æ–¼æ­¤é‡æ§‹ä¸»è¦æ˜¯ç§»é™¤åŠŸèƒ½è€Œéæ–°å¢ï¼Œæ¸¬è©¦é‡é»åœ¨æ–¼ï¼š
- æ ¸å¿ƒåŠŸèƒ½ä¸å—å½±éŸ¿
- UI æ­£ç¢ºé¡¯ç¤ºä¸­æ–‡
- å°è¦½æ­£å¸¸é‹ä½œ

---

## ğŸ”— åƒè€ƒè³‡æ–™

- [next-intl æ–‡æª”](https://next-intl-docs.vercel.app/)
- [Next.js é‡å®šå‘](https://nextjs.org/docs/app/api-reference/next-config-js/redirects)
- ç¿»è­¯åƒè€ƒï¼š`messages/zh.json`

---

## âœ… å®Œæˆæ¢ä»¶ï¼ˆDone Criteriaï¼‰

ç•¶æ»¿è¶³ä»¥ä¸‹æ¢ä»¶æ™‚ï¼Œæ­¤ä»»å‹™è¦–ç‚º **Completed**ï¼š

- [ ] æ‰€æœ‰ AC é€šé
- [ ] `pnpm run build` æˆåŠŸ
- [ ] `pnpm run typecheck` ç„¡éŒ¯èª¤
- [ ] æ‰‹å‹•æ¸¬è©¦æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸
- [ ] ç¨‹å¼ç¢¼å·²æäº¤ä¸¦æ¨é€

---

## ğŸ“ é—œéµæª”æ¡ˆå¿«é€Ÿåƒè€ƒ

**ç¿»è­¯å°ç…§è¡¨ï¼ˆå¸¸ç”¨ï¼‰**ï¼š

| ç¿»è­¯ Key | ä¸­æ–‡å€¼ |
|---------|-------|
| `common.save` | å„²å­˜ |
| `common.cancel` | å–æ¶ˆ |
| `common.delete` | åˆªé™¤ |
| `common.edit` | ç·¨è¼¯ |
| `common.loading` | è¼‰å…¥ä¸­... |
| `common.confirm` | ç¢ºèª |
| `common.back` | è¿”å› |
| `common.next` | ä¸‹ä¸€æ­¥ |
| `common.submit` | æäº¤ |
| `common.search` | æœå°‹ |
| `product.title` | æœå‹™/é …ç›® |
| `quotation.title` | å ±åƒ¹å–® |
| `customer.title` | å®¢æˆ¶ |
| `supplier.title` | ä¾›æ‡‰å•† |
| `dashboard.welcomeBack` | æ­¡è¿å›ä¾† |
| `nav.dashboard` | å„€è¡¨æ¿ |
| `nav.products` | æœå‹™/é …ç›® |
| `nav.quotations` | å ±åƒ¹å–® |
| `nav.customers` | å®¢æˆ¶ |
| `nav.settings` | è¨­å®š |

å®Œæ•´ç¿»è­¯è«‹åƒè€ƒï¼š`messages/zh.json`
