name: Sync Secrets to Cloudflare Workers

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - '.github/workflows/sync-secrets.yml'

jobs:
  sync-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Sync CSRF_SECRET to Cloudflare Workers
        run: |
          curl -X PUT "https://api.cloudflare.com/client/v4/accounts/${{ secrets.CLOUDFLARE_ACCOUNT_ID }}/workers/scripts/quotation-system/secrets" \
            -H "Authorization: Bearer ${{ secrets.CLOUDFLARE_API_TOKEN }}" \
            -H "Content-Type: application/json" \
            --data '{"name":"CSRF_SECRET","text":"${{ secrets.CSRF_SECRET }}","type":"secret_text"}' \
            --fail-with-body
        env:
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
